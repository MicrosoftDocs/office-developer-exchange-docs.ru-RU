---
title: Инструментирование запросов клиентов для EWS и REST в Exchange
manager: sethgros
ms.date: 4/13/2016
ms.audience: Developer
localization_priority: Normal
ms.assetid: 330de503-498d-447e-b4a9-c20fc1699fd1
description: Сведения о заголовках HTTP в службах EWS и REST, которые могут помочь отслеживать и устранять неполадки в приложении Exchange.
ms.openlocfilehash: bcf362952c29956729c44397043a56bf3603d0af
ms.sourcegitcommit: 34041125dc8c5f993b21cebfc4f8b72f0fd2cb6f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/25/2018
ms.locfileid: "19761142"
---
# <a name="instrumenting-client-requests-for-ews-and-rest-in-exchange"></a><span data-ttu-id="8aa9a-103">Инструментирование запросов клиентов для EWS и REST в Exchange</span><span class="sxs-lookup"><span data-stu-id="8aa9a-103">Instrumenting client requests for EWS and REST in Exchange</span></span>

<span data-ttu-id="8aa9a-104">Сведения о заголовках HTTP в службах EWS и REST, которые могут помочь отслеживать и устранять неполадки в приложении Exchange.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-104">Learn about the HTTP headers in EWS and REST requests and responses that can help you monitor and troubleshoot your Exchange application.</span></span>
  
<span data-ttu-id="8aa9a-105">Возникала ли эта проблема?</span><span class="sxs-lookup"><span data-stu-id="8aa9a-105">Has this ever happened to you?</span></span> <span data-ttu-id="8aa9a-106">Пользователь приложения сообщает о непредвиденной ошибке.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-106">A user of your application reports an unexpected error.</span></span> <span data-ttu-id="8aa9a-107">Вы хотите исследовать, но не можете воспроизвести ее.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-107">You want to investigate, but you can't reproduce it.</span></span> <span data-ttu-id="8aa9a-108">Сообщение об ошибке исчезло, и у вас остается очень мало данных для действий.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-108">The error has disappeared for the user, and you're left with very little actionable data.</span></span> <span data-ttu-id="8aa9a-109">Неприятность?</span><span class="sxs-lookup"><span data-stu-id="8aa9a-109">Frustrating, isn't it?</span></span> <span data-ttu-id="8aa9a-110">Давайте рассмотрим, как можно заблаговременно подготовиться к этому сценарию и в будущем избежать разочарования.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-110">Let's look at how you can proactively prepare for this scenario and hopefully avoid frustration in the future.</span></span>
  
## <a name="add-instrumentation-to-requests"></a><span data-ttu-id="8aa9a-111">Добавление инструментирования в запросы</span><span class="sxs-lookup"><span data-stu-id="8aa9a-111">Add instrumentation to requests</span></span>

<span data-ttu-id="8aa9a-112">Рекомендуется добавить в запросы дополнительные заголовки HTTP для упрощения устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-112">We recommend that you add additional HTTP headers to your requests to facilitate troubleshooting.</span></span> <span data-ttu-id="8aa9a-113">Следует хранить запись этих сведений в любом месте (например, в файле журнала), чтобы при необходимости его можно было получить позже.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-113">You should keep a record of this information somewhere (for example, in a log file) so that you can retrieve it later if you need to.</span></span> <span data-ttu-id="8aa9a-114">Это полезно при изучении сетевого трафика, а также при обращении в службу поддержки Майкрософт за помощью.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-114">This is helpful when examining network traffic, and is also helpful if you contact Microsoft support for assistance.</span></span>
  
<span data-ttu-id="8aa9a-115">**Таблица 1. Заголовки запросов для устранения неполадок**</span><span class="sxs-lookup"><span data-stu-id="8aa9a-115">**Table 1. Request headers for troubleshooting**</span></span>

|<span data-ttu-id="8aa9a-116">**HTTP-заголовок (EWS)**</span><span class="sxs-lookup"><span data-stu-id="8aa9a-116">**HTTP header (EWS)**</span></span>|<span data-ttu-id="8aa9a-117">**Эквивалент управляемого API EWS**</span><span class="sxs-lookup"><span data-stu-id="8aa9a-117">**EWS Managed API equivalent**</span></span>|<span data-ttu-id="8aa9a-118">**Примечания**</span><span class="sxs-lookup"><span data-stu-id="8aa9a-118">**Notes**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="8aa9a-119">User — Agent</span><span class="sxs-lookup"><span data-stu-id="8aa9a-119">User-Agent</span></span>  <br/> |[<span data-ttu-id="8aa9a-120">ExchangeService. UserAgent</span><span class="sxs-lookup"><span data-stu-id="8aa9a-120">ExchangeService.UserAgent</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.useragent%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="8aa9a-121">Задайте для этого свойства уникальное значение, идентифицирующее клиентское приложение.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-121">Set this to a unique value that identifies your client application.</span></span><br/><br/> <span data-ttu-id="8aa9a-122">Использование одного и того же значения для всех запросов, отправляемых вашим приложением, позволяет корпорации Майкрософт устранять неполадки вызовов, если они возникают.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-122">Using the same value for all requests that your application sends allows Microsoft to help troubleshoot call failures, should they arise.</span></span>  <br/> |
|<span data-ttu-id="8aa9a-123">клиентский идентификатор запроса</span><span class="sxs-lookup"><span data-stu-id="8aa9a-123">client-request-id</span></span>  <br/> |[<span data-ttu-id="8aa9a-124">ExchangeService. Клиентрекуестид</span><span class="sxs-lookup"><span data-stu-id="8aa9a-124">ExchangeService.ClientRequestId</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.clientrequestid%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="8aa9a-125">Присвойте этому параметру другое уникальное значение для каждого запроса, отправляемого приложением.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-125">Set this to a different unique value for every request your application sends.</span></span><br/><br/> <span data-ttu-id="8aa9a-126">Рекомендуется использовать GUID.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-126">We recommend that you use a GUID.</span></span> <span data-ttu-id="8aa9a-127">Этот уникальный идентификатор используется для корреляции действий между двумя системами в случае, если что-то пошло не так.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-127">This unique identifier is intended to be used to correlate activities between two systems in the event that something goes wrong.</span></span>  <br/> |
|<span data-ttu-id="8aa9a-128">Возврат — клиент — запрос — идентификатор</span><span class="sxs-lookup"><span data-stu-id="8aa9a-128">return-client-request-id</span></span>  <br/> |[<span data-ttu-id="8aa9a-129">ExchangeService. Ретурнклиентрекуестид</span><span class="sxs-lookup"><span data-stu-id="8aa9a-129">ExchangeService.ReturnClientRequestId</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.returnclientrequestid%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="8aa9a-130">Присвойте этому параметру **значение true** , чтобы сообщить серверу Exchange о том, что он должен возвратить значение идентификатора клиентского запроса в соответствующем ответе.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-130">Set this to **true** to signal to the Exchange server that it should return the value of your client-request-id in the corresponding response.</span></span><br/><br/> <span data-ttu-id="8aa9a-131">Это можно использовать для сопоставления запросов и ответов в трассировках сети или трассировок управляемого API EWS.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-131">You can use this to correlate requests and responses in network traces or EWS Managed API traces.</span></span>  <br/> |
|<span data-ttu-id="8aa9a-132">X — Клиентстатистикс</span><span class="sxs-lookup"><span data-stu-id="8aa9a-132">X-ClientStatistics</span></span>  <br/> |[<span data-ttu-id="8aa9a-133">ExchangeService. СендклиентлатенЦиес</span><span class="sxs-lookup"><span data-stu-id="8aa9a-133">ExchangeService.SendClientLatencies</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="8aa9a-134">Используется для [отправки отчетов о задержких EWS](#bk_ReportLatency) в корпорацию Майкрософт, если приложение получает доступ к Exchange Online или Exchange Online в составе Office 365.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-134">Used to [report EWS latencies](#bk_ReportLatency) to Microsoft if your application is accessing Exchange Online or Exchange Online as part of Office 365.</span></span>  <br/> |
   
## <a name="log-information-from-responses"></a><span data-ttu-id="8aa9a-135">Запись данных из ответов в журнал</span><span class="sxs-lookup"><span data-stu-id="8aa9a-135">Log information from responses</span></span>

<span data-ttu-id="8aa9a-136">Так как клиент может добавить к отправляемым запросам дополнительные инструментирования, Exchange добавляет дополнительные инструментирования в ответы в виде заголовков HTTP.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-136">Just as your client can add additional instrumentation to the requests it sends, Exchange adds additional instrumentation to the responses in the form of HTTP headers.</span></span> <span data-ttu-id="8aa9a-137">Клиент должен записать эти сведения, чтобы перейти к сведениям об инструментарии запросов.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-137">Your client should capture this information to go along with the request instrumentation information.</span></span>
  
> [!NOTE]
> <span data-ttu-id="8aa9a-138">Если вы используете управляемый API EWS, не существует прямого эквивалента для заголовков HTTP.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-138">If you are using the EWS Managed API, there is no direct equivalent for the HTTP headers.</span></span> <span data-ttu-id="8aa9a-139">Тем не менее все заголовки HTTP-ответа можно получить с помощью свойства [ExchangeService. хттпреспонсехеадерс](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.httpresponseheaders%28v=exchg.80%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="8aa9a-139">However, all HTTP response headers can be accessed via the [ExchangeService.HttpResponseHeaders](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.httpresponseheaders%28v=exchg.80%29.aspx) property.</span></span> 
  
<span data-ttu-id="8aa9a-140">**Таблица 2. Заголовки ответа HTTP**</span><span class="sxs-lookup"><span data-stu-id="8aa9a-140">**Table 2. HTTP response headers**</span></span>

|<span data-ttu-id="8aa9a-141">**Заголовок HTTP**</span><span class="sxs-lookup"><span data-stu-id="8aa9a-141">**HTTP header**</span></span>|<span data-ttu-id="8aa9a-142">**Описание**</span><span class="sxs-lookup"><span data-stu-id="8aa9a-142">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="8aa9a-143">Идентификатор запроса</span><span class="sxs-lookup"><span data-stu-id="8aa9a-143">request-id</span></span>  <br/> |<span data-ttu-id="8aa9a-144">Созданный сервером идентификатор запроса, который соответствует этому ответу.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-144">A server-generated ID for the request that corresponds to this response.</span></span>  <br/> |
|<span data-ttu-id="8aa9a-145">клиентский идентификатор запроса</span><span class="sxs-lookup"><span data-stu-id="8aa9a-145">client-request-id</span></span>  <br/> |<span data-ttu-id="8aa9a-146">Значение заголовка Client — Request/ID в запросе.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-146">The value of the client-request-id header in the request.</span></span><br/><br/> <span data-ttu-id="8aa9a-147">Этот заголовок присутствует, только если запрос содержит заголовок Return-Client-Request-ID со значением **true**.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-147">This header is only present if the request contains the return-client-request-id header with a value of **true**.</span></span>  <br/> |
|<span data-ttu-id="8aa9a-148">X — Фесервер</span><span class="sxs-lookup"><span data-stu-id="8aa9a-148">X-FEServer</span></span>  <br/> |<span data-ttu-id="8aa9a-149">Полное доменное имя сервера клиентского доступа, который обработал запрос.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-149">The FQDN of the Client Access server that processed the request.</span></span>  <br/> |
|<span data-ttu-id="8aa9a-150">X — Таржетбесервер</span><span class="sxs-lookup"><span data-stu-id="8aa9a-150">X-TargetBEServer</span></span>  <br/> |<span data-ttu-id="8aa9a-151">Полное доменное имя сервера почтовых ящиков, который обработал запрос.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-151">The FQDN of the mailbox server that processed the request.</span></span>  <br/> |
|<span data-ttu-id="8aa9a-152">X — Diaginfo.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-152">X-DiagInfo</span></span>  <br/> |<span data-ttu-id="8aa9a-153">Дополнительные диагностические сведения в зависимости от запроса.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-153">Additional diagnostic information, depending on the request.</span></span>  <br/> |
|<span data-ttu-id="8aa9a-154">x — MS — диагностика</span><span class="sxs-lookup"><span data-stu-id="8aa9a-154">x-ms-diagnostics</span></span>  <br/> | <span data-ttu-id="8aa9a-155">Этот заголовок применяется только в том случае, если в запросе используется проверка подлинности OAuth.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-155">This header is only applicable if OAuth authentication is used in the request.</span></span><br/><br/> <span data-ttu-id="8aa9a-156">Он содержит явный код ошибки, указывающий, почему не удалось выполнить проверку подлинности OAuth.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-156">It contains an explicit error code that specifies why an OAuth authentication failed.</span></span><br/><br/> <span data-ttu-id="8aa9a-157">Он принимает следующий формат:`errorId;reason="reason"error_type="error type"`</span><span class="sxs-lookup"><span data-stu-id="8aa9a-157">It takes the following format: `errorId;reason="reason"error_type="error type"`</span></span><br/><br/> <span data-ttu-id="8aa9a-158">Поле **Reason** является понятным для человека описанием ошибки.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-158">The **reason** field is a human-readable description of the error.</span></span><br/><br/> <span data-ttu-id="8aa9a-159">Поле **еррорид** является целым числом, а поле **тип\_ошибки** — строковым представлением этого целого числа, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="8aa9a-159">The **errorId** field is an integer, and the **error\_type** field is the string representation of that integer, as follows:</span></span><ul><li><span data-ttu-id="8aa9a-160">2000000: недопустимая\_подпись</span><span class="sxs-lookup"><span data-stu-id="8aa9a-160">2000000: invalid\_signature</span></span></li><li><span data-ttu-id="8aa9a-161">2000001: недопустимый\_маркер</span><span class="sxs-lookup"><span data-stu-id="8aa9a-161">2000001: invalid\_token</span></span></li><li>  <span data-ttu-id="8aa9a-162">2000002: истек\_срок действия маркера</span><span class="sxs-lookup"><span data-stu-id="8aa9a-162">2000002: token\_expired</span></span></li><li><span data-ttu-id="8aa9a-163">2000003: недопустимый\_ресурс</span><span class="sxs-lookup"><span data-stu-id="8aa9a-163">2000003: invalid\_resource</span></span></li><li><span data-ttu-id="8aa9a-164">2000004: недопустимый\_клиент</span><span class="sxs-lookup"><span data-stu-id="8aa9a-164">2000004: invalid\_tenant</span></span>  </li><li><span data-ttu-id="8aa9a-165">2000005: недопустимый\_пользователь</span><span class="sxs-lookup"><span data-stu-id="8aa9a-165">2000005: invalid\_user</span></span></li><li><span data-ttu-id="8aa9a-166">2000006: недопустимый\_клиент</span><span class="sxs-lookup"><span data-stu-id="8aa9a-166">2000006: invalid\_client</span></span></li><li><span data-ttu-id="8aa9a-167">2000007: внутренняя\_ошибка</span><span class="sxs-lookup"><span data-stu-id="8aa9a-167">2000007: internal\_error</span></span></li><li><span data-ttu-id="8aa9a-168">2000008: недопустимое\_разрешение</span><span class="sxs-lookup"><span data-stu-id="8aa9a-168">2000008: invalid\_grant</span></span></li></ul> |
   
## <a name="report-ews-latency-to-microsoft"></a><span data-ttu-id="8aa9a-169">Отчет о задержке в Майкрософт</span><span class="sxs-lookup"><span data-stu-id="8aa9a-169">Report EWS latency to Microsoft</span></span>
<span data-ttu-id="8aa9a-170"><a name="bk_ReportLatency"> </a></span><span class="sxs-lookup"><span data-stu-id="8aa9a-170"><a name="bk_ReportLatency"> </a></span></span>

<span data-ttu-id="8aa9a-171">Если ваше приложение использует управляемый API EWS или EWS для подключения к Exchange Online, вы можете сообщить о задержке в запросах EWS напрямую в корпорацию Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-171">If your application uses the EWS Managed API or EWS to connect to Exchange Online, you can report latency in EWS requests directly to Microsoft.</span></span> <span data-ttu-id="8aa9a-172">Информация передается через заголовок запроса X-Клиентстатистикс.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-172">The information is passed via the X-ClientStatistics request header.</span></span> <span data-ttu-id="8aa9a-173">Если вы используете управляемый API EWS, все, что нужно сделать, — задать для свойства [ExchangeService. сендклиентлатенЦиес](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) **значение true**.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-173">If you are using the EWS Managed API, all you have to do is set the [ExchangeService.SendClientLatencies](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) property to **true**.</span></span> <span data-ttu-id="8aa9a-174">Если вы используете EWS, вам потребуется измерить время между отправкой запроса и получением ответа, а затем добавить заголовок X – Клиентстатистикс в следующий запрос EWS, который отправляет ваше приложение, используя следующий формат.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-174">If you are using EWS, you'll need to measure the time between issuing a request and receiving a response, then add the X-ClientStatistics header to the next EWS request your application sends, using the following format.</span></span>
  
`X-ClientStatistics: MessageId=<value of request-id header>,ResponseTime=<time in milliseconds>,SoapAction=<EWS operation>`
  
<span data-ttu-id="8aa9a-175">Мы поддерживаем отчеты для этих задержек и используем их для непрерывного усовершенствования служб EWS в Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-175">We maintain reports for these latencies and use them to continuously improve EWS services in Exchange Online.</span></span>
  
## <a name="next-steps"></a><span data-ttu-id="8aa9a-176">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="8aa9a-176">Next steps</span></span>
<span data-ttu-id="8aa9a-177"><a name="bk_ReportLatency"> </a></span><span class="sxs-lookup"><span data-stu-id="8aa9a-177"><a name="bk_ReportLatency"> </a></span></span>

<span data-ttu-id="8aa9a-178">После добавления клиентского инструментария в приложение лучше подготовиться, если что-то пойдет не так.</span><span class="sxs-lookup"><span data-stu-id="8aa9a-178">After you've added client instrumentation to your application, you're better prepared if something goes wrong.</span></span> <span data-ttu-id="8aa9a-179">Если это произойдет, вы можете использовать данные инструментирования для [устранения неполадок в приложении](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md).</span><span class="sxs-lookup"><span data-stu-id="8aa9a-179">If that happens, you can use your instrumentation data to [troubleshoot your application](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="8aa9a-180">См. также</span><span class="sxs-lookup"><span data-stu-id="8aa9a-180">See also</span></span>

- [<span data-ttu-id="8aa9a-181">Общие сведения о разработке клиента EWS для Exchange</span><span class="sxs-lookup"><span data-stu-id="8aa9a-181">EWS client design overview for Exchange</span></span>](ews-client-design-overview-for-exchange.md)
- [<span data-ttu-id="8aa9a-182">Трассировка запросов и ответов для устранения неполадок в приложениях управляемого API EWS</span><span class="sxs-lookup"><span data-stu-id="8aa9a-182">Trace requests and responses to troubleshoot EWS Managed API applications</span></span>](how-to-trace-requests-responses-to-troubleshoot-ews-managed-api-applications.md)
- [<span data-ttu-id="8aa9a-183">Инструменты и ресурсы для устранения неполадок приложений EWS для Exchange</span><span class="sxs-lookup"><span data-stu-id="8aa9a-183">Tools and resources for troubleshooting EWS applications for Exchange</span></span>](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md)
    

