---
title: Веб-служб Exchange регулирования в Exchange
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: b4fff4c9-c625-4d2a-9d14-bb28a5da5baf
description: Сведения о политиках регулирования, влияющие на веб-служб Exchange, при использовании Exchange.
ms.openlocfilehash: e7966f67753b3998235e000a022e41c90fa227b8
ms.sourcegitcommit: 34041125dc8c5f993b21cebfc4f8b72f0fd2cb6f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19761003"
---
# <a name="ews-throttling-in-exchange"></a>Веб-служб Exchange регулирования в Exchange

Сведения о политиках регулирования, влияющие на веб-служб Exchange, при использовании Exchange.
  
**Автор:** Glen шкал; Майкл Mainer, корпорация Майкрософт 
  
Статья предоставляет сведения о веб-служб Exchange регулирование в Exchange Online, Exchange Online в составе Office 365 и локальной версии Exchange, начиная с Exchange 2010. Регулирование в Exchange гарантирует и надежность сервера, ограничив число объем ресурсов сервера, которые можно использовать с одним пользователем или приложением. Регулирование — это реагирующее ответ используйте чем это необходимо системных ресурсов, которые могут повлиять на надежность службы и функциональные возможности. Exchange постоянно отслеживает работоспособность инфраструктуры важных ресурсов, таких как базы данных почтовых ящиков. При обнаружении высокой нагрузки факторов, к снижению производительности эти ресурсы подключения к веб-служб Exchange регулирование пропорционально в зависимости от объема, это условие высокой нагрузки участвовал каждого вызывающего абонента. Результатом является, что пользователь может находиться внутри предела регулирования и сохранилась снижения, пока не будет работоспособности ресурса обратно в действующие уровни.
  
Каждого протокола клиентского доступа в Exchange, включая веб-служб Exchange, имеет политики регулирования. При разработке приложений, использующих веб-служб Exchange, важно учетной записи для политик регулирования, для обеспечения надежности приложения и работоспособности сервера Exchange. В этой статье определяются различные политики регулирования и ограничения для службы для веб-служб Exchange, будет ли Exchange Online или версии Exchange локальных начиная с Exchange Server 2010. В зависимости от настроек в этой статье также рассматриваются различия в регулирование политик в различных версиях Exchange.
  
> [!IMPORTANT]
> По умолчанию политики регулирования, доступ к политики регулирования и настройка политики регулирования отличается от Exchange Online локальную систему Exchange. Отдельные регулирования значения параметра правильность только для определенной версии Exchange. Поскольку значения параметра зависят от версии, и администраторы Exchange могут изменять регулирования политик для локальных развертываний по умолчанию, в этой статье отсутствуют по умолчанию значения параметров. Более важна, позволяющая необходимо учитывать вопросы по проектированию приложение, которое работает в рамках пределы регулирования и отвечает надлежащим образом для регулирования сценариев. 
  
Если разработчик приложения, необходимо учесть регулирование в проект приложения. Различными версиями Exchange иметь разные значения по умолчанию для параметров регулирования веб-служб Exchange. Клиентские и службы приложения, которые предназначены для доступа к другой версии Exchange будут должны учитывать эти параметры ли значения по умолчанию, пользовательские значения, заданные администратором Exchange, или, как и для Exchange Online, по умолчанию, а не обнаруживаемые. Из-за регулирование значений параметров не могут быть программным способом, спецификаций вашего клиента должна включать план для приложения адаптироваться к другой потенциал пределы регулирования. При разработке многопоточных приложений, которые будут получать доступ к большому количеству почтовых ящиков или когда количество клиентов доступ к одному почтовому ящику, рассмотрите возможность ограничения для параллельного, применяемую политику по умолчанию для Exchange. 
  
## <a name="throttling-policies-that-affect-ews"></a>Регулирование политики, влияющие на веб-служб Exchange
<a name="bk_PolicyParameters"> </a>

Регулирование политик в силу Exchange не только веб-служб Exchange, но также все клиентские подключения к серверу Exchange, включая протоколы, используемые с Microsoft Office Outlook, Outlook Web App и Exchange ActiveSync. 
  
При использовании Exchange 2010 **CPUStartPercent** политики регулирования могут влиять на производительность веб-служб Exchange. Если среднее значение использования ЦП Exchange обрабатывает на сервере клиентского доступа, включая, среди прочего, процесс веб-служб Exchange, превышает значение, указанное этой политикой, входящих запросов фантомных сократить использование ЦП. Значение этой политики изменить нельзя, но уведомления, которые помогут проблем с производительностью. Логика выборки, выполняемых на сервере клиентского доступа для этого значения — это среднее значение через чередующихся окно 10 секунд. Это позволяет процесс реагировать на быстрого пики уровень использования ЦП. При превышении этой пороговое значение отсрочки входящие подключения к веб-служб Exchange. Задержка ограничен 500 миллисекунд (мс) в абстрактной использование 100% ресурсов ЦП за один запрос веб-служб Exchange. Если пакетному запросу веб-служб Exchange для получения 100 элементов передается, сервер будет искать ЦП 100 раз (один раз в элемент) Максимальная задержка 50 секунд. Время задержки линейно пропорционально использованию ЦП. В **CPUStartPercent**задержка — 0 (функция доход потока), а также повышает линейно до 500 мс на 100% ЦП. Поскольку политик регулирования применяются ко всем пользователям Exchange, маловероятно, что использование ресурсов ЦП превышает ограничение **CPUStartPercent** на сервере клиентского доступа Exchange, так как отдельных пользователей или приложений не удается получить достаточно ЦП, чтобы повлиять на Операция сервера. 
  
В следующей таблице перечислены параметры политики регулирования, влияющие на приложения, использующие веб-служб Exchange.
  
**Таблица 1: Регулирование параметры политики, которые влияют на веб-служб Exchange**

|**Имя параметра политики регулирования**|**Применимо к**|**Описание**|
|:-----|:-----|:-----|
|**DiscoveryMaxConcurrency** <br/> |Exchange 2013  <br/> Exchange Online  <br/> |Указывает количество одновременных обнаружения поиска подключений, которые пользователь может выполнять одновременно.  <br/> |
|**DiscoveryMaxKeywords** <br/> |Exchange 2013  <br/> Exchange Online  <br/> |Указывает максимальное количество ключевых слов, которые пользователь может включать в поиск обнаружения.  <br/> |
|**DiscoveryMaxKeywordsPerPage** <br/> |Exchange 2013  <br/> Exchange Online  <br/> |Задает число ключевых слов, для которых отображается статистика.  <br/> |
|**DiscoveryMaxMailboxes** <br/> |Exchange 2013  <br/> Exchange Online  <br/> |Указывает максимальное количество исходных почтовых ящиков, которые пользователь может включать в поиск обнаружения.  <br/> |
|**DiscoveryMaxMailboxesResultsOnly** <br/> |Exchange 2013  <br/> Exchange Online  <br/> |Указывает максимальное количество почтовых ящиков, можно выполнить поиск в eDiscovery на месте поиска без просмотра статистики.  <br/> |
|**DiscoveryPreviewSearchResultsPageSize** <br/> |Exchange 2013  <br/> Exchange Online  <br/> |Указывает количество сообщений, возвращаемых в ответе Предварительный просмотр поиска обнаружения электронных данных.  <br/> |
|**EwsCutoffBalance** <br/> |Exchange 2013  <br/> Exchange Online  <br/> |Определяет ограничение на потребление ресурсов для пользователя веб-служб Exchange, прежде чем является окончательным запретом выполнения операций с определенным компонентом.  <br/> |
|**EwsMaxBurst** <br/> |Exchange 2013  <br/> Exchange Online  <br/> |Задает количество времени, пользователя с веб-служб Exchange можно использовать с повышенными привилегиями объем ресурсов, прежде чем регулирование. Измеряется в миллисекундах. Это значение отдельно для каждого компонента.  <br/> |
|**EwsRechargeRate** <br/> |Exchange 2013  <br/> Exchange Online  <br/> |Определяет скорость, при которой бюджет пользователя веб-служб Exchange — это зарядить (бюджета увеличивает на) в течение бюджетного времени.  <br/> |
|**EWSMaxSubscriptions** <br/> |Exchange 2010  <br/> Exchange 2013  <br/> Exchange Online  <br/> |Определяет максимальное число активных push репликации по запросу и потоковая передача подписки на уведомления, которые пользователь может выполнять на определенном сервере клиентского доступа за один раз. Это бюджетные по-разному для разных версий Exchange.  <br/> |
|**EWSFastSearchTimeoutInSeconds** <br/> |Exchange 2010  <br/> |Определяет период времени в секундах, прежде чем они продолжить быстрого поиска, выполненные с помощью поиска Exchange в веб-время ожидания. Быстрый поиск, внесенные с помощью строки запроса на расширенный синтаксис запроса (AQS) в ходе [операции FindItem](http://msdn.microsoft.com/library/ebad6aae-16e7-44de-ae63-a95b24539729%28Office.15%29.aspx)операций поиска.  <br/> |
|**EWSFindCountLimit** <br/> |Exchange 2010  <br/> Exchange 2013  <br/> Exchange Online  <br/> |Определяет максимальное число элементов из [FindItem операции](http://msdn.microsoft.com/library/ebad6aae-16e7-44de-ae63-a95b24539729%28Office.15%29.aspx) или [операции FindFolder](http://msdn.microsoft.com/library/7a9855aa-06cc-45ba-ad2a-645c15b7d031%28Office.15%29.aspx) , которые могут находиться в памяти на сервере клиентского доступа за один раз для каждого пользователя. Значение по умолчанию для этого свойства равно 1000. [Резервный значение](http://technet.microsoft.com/en-us/library/dd297964%28v=exchg.141%29.aspx#fallback)это значение равно 1000.  <br/> В Exchange Online и локальной версии Exchange, начиная с Exchange 2013 этой политики регулирования нельзя запросы или настроить командлетом. В Exchange Online и локальной версии Exchange, начиная с Exchange 2013, EWSFindCountLimit [AQS](how-to-perform-an-aqs-search-by-using-ews-in-exchange.md) поиска и любые Exchange поиска с ограничением — 250 результатов. Возвращает до 1000 результатов поиска Exchange без ограничений.  <br/> |
|**EWSPercentTimeInAD** <br/> |Exchange 2010  <br/> |Определяет процент времени, в минуту, во время которого пользователь может выполнять запросы Active Directory.  <br/> |
|**EWSPercentTimeInCAS** <br/> |Exchange 2010  <br/> |Определяет процент времени, в течение которого определенного пользователя может выполнять код сервера клиентского доступа минуту.  <br/> |
|**EWSPercentTimeInMailboxRPC** <br/> |Exchange 2010  <br/> |Определяет процент времени, в минуту, во время которого определенного пользователя может выполнять запросы RPC почтовых ящиков  <br/> |
|**EWSMaxConcurrency** <br/> |Exchange 2010  <br/> Exchange 2013  <br/> Exchange Online  <br/> |Определяет число одновременных подключений open отдельного пользователя, у которых есть с Exchange server, используемая, веб-служб Exchange за один раз. Значение по умолчанию для Exchange 2010 — 10. Значение по умолчанию для Exchange 2013 и Exchange Online: 27.  <br/> Этот параметр применяется ко всем операциям за исключением потоковая передача уведомления о. Чтобы указать число открытых подключений потоковой передачи событий, которые доступны потоковой передачи уведомлений использовать **HangingConnectionLimit** . Дополнительные сведения можно [регулирования значения необходимо принять во внимание?](how-to-maintain-affinity-between-group-of-subscriptions-and-mailbox-server.md#bk_throttling).  <br/> |
|**MessageRateLimit** <br/> |Exchange 2010  <br/> Exchange 2013  <br/> Exchange Online  <br/> |Определяет количество сообщений в минуту, предназначенной для отправки.  <br/> |
|**RecipientRateLimit** <br/> |Exchange 2010  <br/> Exchange 2013  <br/> Exchange Online  <br/> |Задает ограничение на количество получателей, которые пользователь может адресовать в течение 24 часов.  <br/> |
|**ForwardeeLimit** <br/> |Exchange 2010  <br/> Exchange 2013  <br/> Exchange Online  <br/> |Определяет предельное число получателей для папки "Входящие" вперед/перенаправления действия в течение 24 часов.  <br/> |
   
> [!CAUTION]
> Не задана регулирование политик **значения NULL**. Будет применена политика равное не ограничен, это означает, что политики регулирования не задано. 
  
## <a name="displaying-the-policies-that-apply-to-exchange-mailboxes"></a>Отображение политик, которые применяются к почтовым ящикам Exchange
<a name="bk_PolicyCmdlets"> </a>

Локальную систему Exchange предоставляет командлетам командной консоли Exchange, которые можно использовать для задания и получения политики регулирования. Exchange Online не предоставляет доступ к командлетам регулирования политики.
  
Можно использовать следующие командлеты для отображения регулирование политик для локального развертывания Exchange Server:
  
- **Get-ThrottlingPolicy** — получает политики регулирования регулирования параметры для одной или нескольких клиентов. Для получения дополнительных сведений см [Get-ThrottlingPolicy](http://technet.microsoft.com/en-us/library/dd351264.aspx) . 
    
- **Get-ThrottlingPolicyAssociation** — позволяет просмотреть отношения между объектом и связанных с ним политик регулирования. Объект может быть пользователя с почтовым ящиком, пользователь без почтового ящика или контакт. Для получения дополнительных сведений см [Get-ThrottlingPolicyAssociation](http://technet.microsoft.com/en-us/library/ff459241.aspx) . 
    
Используйте следующую команду, чтобы показать политики для Exchange 2010 регулирования по умолчанию.
  
**Get-ThrottlingPolicy | Where-Object {$_. IsDefault - eq «True»} | Format-list**
  
Используйте следующую команду для отображения глобальной политики регулирования (который соответствует политики регулирования по умолчанию в Exchange 2010) в Exchange 2013.
  
**Get-ThrottlingPolicy | Where-Object {$_. ThrottlingPolicyScope - eq «глобальные»} | Format-list**
  
Используйте следующую команду, чтобы показать регулирования политики, связанные с пользователем в Exchange 2010 или Exchange 2013. Замените имя конечного пользователя, для которого вы хотите получить регулирование сведений о политике john@contoso.com имя пользователя.
  
**Get-ThrottlingPolicyAssociation john@contoso.com | Format-list**
  
Выполнив эту команду в Exchange консоли приводит к выходного следующим образом.
  
```powershell
PS C:\>Get-ThrottlingPolicyAssociation john@contoso.com
RunspaceId               : 72153d6-9dce-2fae-8dbd-5ca5f760g2df
ObjectId                 : john
ThrottlingPolicyId       :
Name                     : john
Identity                 : FHXB-28178dom.contoso.com/Users/john
IsValid                  : True
NeedsToSuppressPii       : False
ExchangeVersion          : 0.10 (15.0.0.0)
DistinguishedName        : CN=john,CN=Users,DC=FHXB-28178dom,DC=contoso,DC=com
Guid                     : 2c10dab6-de28-1937-ad8g-535832613a08
```

> [!NOTE]
> Если свойство **ThrottlingPolicyId** не задан, политики по умолчанию применяется к почтовому ящику. 
  
Можно настроить политики на сервере Exchange регулирования с помощью командлета [Set-ThrottlingPolicy](http://technet.microsoft.com/en-us/library/dd298094.aspx) и [Set-ThrottlingPolicyAssociation](http://technet.microsoft.com/en-us/library/ff459231.aspx) . Можно создавать и удалять политики регулирования с помощью командлетов [New-ThrottlingPolicy](http://technet.microsoft.com/en-us/library/dd351045.aspx) и [Remove-ThrottlingPolicy](http://technet.microsoft.com/en-us/library/dd351178.aspx) не по умолчанию. 
  
> [!TIP]
> Мы рекомендуем разработке приложений выполняются для политики регулирования по умолчанию. Только вносите изменения в по умолчанию политики регулирования, если при разработке клиентского приложения нельзя разместить политики по умолчанию. Обратите внимание, что меньше ограничений политик регулирования может отрицательно сказаться на надежность службы. 
  
## <a name="throttling-considerations-for-applications-that-use-ews-impersonation"></a>Регулирование рекомендации для приложений, применяющих олицетворение EWS
<a name="bk_ThrottlingConsiderations"> </a>

[Олицетворение](impersonation-and-ews-in-exchange.md) — это метод авторизации, который позволяет одной учетной записи для доступа к несколько учетных записей. Если учетная запись службы олицетворяется пользователей, его выступает в роли пользователей и таким образом предполагает прав, назначенных для этих пользователей. Файлы журналов запишите access под учетной записью олицетворения пользователя. Администраторы управления доступом на основе ролей (RBAC) используется для настройки олицетворения с помощью командной консоли Exchange. 
  
При использовании олицетворения бюджеты для регулирования пороговые значения применяются по-разному в зависимости от версии Exchange. Бюджета либо рассчитывается от учетной записи, которая является олицетворение или учетная запись службы. Если приложение многопотоковость и делает параллельных запросов к нескольким почтовым ящикам, необходимо учитывать, как порог регулирования влияют на производительность вашего приложения. Как правило необходимо учитывать следующие ограничения для учетных записей служб, при создании приложения службы, которое использует олицетворение для доступа к всех почтовых ящиков. 
  
- При использовании олицетворения учетная запись службы имеет отдельный бюджет для следующих параметров политики:
    
  - **EWSMaxConcurrency**
    
  - **EWSPercentTimeInAD**
    
  - **EWSPercentTimeInCAS**
    
  - **EWSPercentTimeInMailboxRPC**
    
  - **EWSMaxSubscriptions**
    
  - **EWSFastSearchTimeoutInSeconds**
    
  - **EWSFindCountLimit**
    
- Бюджетные **EWSMaxConcurrency** общего для учетной записи службы и учетной записи олицетворение для всех подключений к версии Exchange, предшествующие Exchange 2010 с пакетом обновления 2 (SP2) накопительный пакет обновления 4 (RU4). Начиная с Exchange 2010 с пакетом обновления 2 RU4, включая Exchange Online, доступа учетной записи службы, используя отдельные бюджета из бюджета **EWSMaxConcurrency** пользователя. Дополнительные сведения об обновлении для политики регулирования Exchange одновременных подключений для веб-служб Exchange можно [Описание из обновить накопительный пакет обновления 4 для Exchange Server 2010 с пакетом обновления 2](http://support.microsoft.com/kb/2706690).
    
    Потоковая передача уведомлений в версиях Exchange, начиная с Exchange 2010 и Exchange Online, включая веб-служб Exchange имеют дополнительных клонированная бюджет **EWSMaxConcurrency** от всех других клиентских подключений веб-служб Exchange. Соединения для потоковой передачи уведомления считаются от отдельный бюджет чем другие операции веб-служб Exchange. Потоковая передача бюджета максимальная степень параллелизма уведомлений — это фактически два разных бюджетов: один бюджет — для всех учетных записей служб, а один бюджет — для учетной записи олицетворение. Потоковая передача уведомлений в Exchange Online и версии Exchange, начиная с Exchange 2013 используйте [HangingConnectionLimit](ews-throttling-in-exchange.md#bk_ThrottlingNotifications) для ограничения числа подключений. 
    
    Например предположим, что **EWSMaxConcurrency** равно 5. Пользователь может быть пять подключений уведомлений open репликации по запросу, а учетной записи службы может иметь пять подключений уведомлений параллельных репликации по запросу для почтового ящика пользователя в то же время, как и пользователь. 
    
- В следующей таблице указываются порядок вычисления регулирования бюджеты **EWSMaxSubscriptions** между учетной записи службы и учетной записи для олицетворения. 
    
   **В таблице 2: EWSMaxSubscriptions бюджет учета**

   |**Версия Exchange**|**EWSMaxSubscriptions регулирования учета бюджета**|
   |:-----|:-----|
   |Exchange Online  <br/> |Вычитается целевой почтовый ящик.  <br/> |
   |Exchange 2013  <br/> |Вычитается целевой почтовый ящик.  <br/> |
   |Пакет обновления 3 для Exchange 2010  <br/> |Вычитается целевой почтовый ящик.  <br/> |
   |Exchange 2010 SP2  <br/> |Вычитается вызывающей учетной записи. Начиная с Exchange 2010 с пакетом обновления 2 RU4 бюджета — это вычитается целевой почтовый ящик.  <br/> |
   |Exchange 2010 SP1  <br/> |Вычитается вызывающей учетной записи.  <br/> |
   |Exchange 2010  <br/> |Вычитается вызывающей учетной записи.  <br/> |
   
- Так как **EWSMaxSubscriptions** регулирование бюджета пользователь с учетной записи олицетворяется, нет ограничений на число почтовых ящиков можно подписаться на и принимать потоковой передачи уведомлений, учетная запись службы, пока олицетворения время использования. Для учетной записи олицетворяется, вы не может иметь более _n_ параллельных запросов на целевой почтовый ящик, где _n_ — это значение **EWSMaxSubscriptions** . Если вы не используете олицетворения, ту же учетную запись службы может не более _n_ параллельных запросов общее. В результате вывод — это с помощью олицетворения учетной записи службы, порядок повышает надежность увеличить количество почтовых ящиков, которые может обслуживать. Для получения дополнительных сведений см [Ведение сходства между группой подписок и сервера почтовых ящиков в Exchange](how-to-maintain-affinity-between-group-of-subscriptions-and-mailbox-server.md).
    
- Параметры политики **EWSPercentTimeInMailboxRPC**, **EWSPercentTimeInCAS**и **EWSPercentTimeInAD** обращайтесь к действия, выполняемые единый поток. Когда приложение выполняет несколько параллельных операций, необходимо учесть воздействие этих операций на бюджет ресурсов пользователя. 
    
## <a name="throttling-implications-for-ews-batch-requests"></a>Регулирование последствия для запросов пакетов веб-служб Exchange
<a name="bk_ThrottlingBatch"> </a>

Веб-служб Exchange позволяет вам для пакетной обработки нескольких запросов элемента в один запрос, который выполняется на сервере клиентского доступа. Это позволяет более высокой эффективности и производительности. Когда сервер Exchange выполняет пакетной запроса, выполняется проверка бюджета пользователя после выполнения каждого элемента в пакете. Если приложение является превышение бюджета, обработка следующего элемента в пакете откладывается, пока не зарядить бюджета для этого пользователя. Для обеспечения успешного выполнения приложения, использующие пакетные операции, Ограничьте число запросов элементов, которые могут быть включены в одном пакете и деления большие пакеты в нескольких пакетах меньшего размера для повышения надежности результаты. Влияние пакетной обработки на определенный регулирования пороговые значения зависит от того, тип запроса, размер элементов для обработки (например, в **UploadItems** или **ExportItems** операций) и их содержимое. Политик регулирования влияет на пакетных операций, вызывая занимать значительно больше времени для обработки запроса. Вызывающего должны больше ожидать ответа, а так как веб-служб Exchange ограничения времени выполнения пакетный запрос на одну минуту, звонок может времени ожидания. 
  
Чтобы определить размер оптимального пакетов для приложения, выполните модульное тестирование, используя различные вводимых пользователем данных устанавливает убедитесь, что приложение не столкнуться с возникновения ошибок в рабочей среде. 
  
## <a name="throttling-policy-parameters-that-affect-ews-search-operations"></a>Параметры политики регулирования, влияющие на веб-служб Exchange операциях поиска
<a name="bk_ThrottlingSearch"> </a>

[Операции поиска в веб-служб Exchange](search-and-ews-in-exchange.md) может потребовать большого объема время и ресурсы, в зависимости от того, как выполнить поиск и запрашивается информация. Чтобы контролировать использование ресурсов во время выполнения поиска, два параметра политики вступили в силу: **EWSFastSearchTimeoutInSeconds** и **EWSFindCountLimit**. 
  
Этот параметр политики **EWSFastSearchTimeoutInSeconds** указывает время, в секундах, быстрый поиск, веб-служб Exchange (также известной как контента индексирования поиска) до истечения их времени ожидания. Fast search является поиска, выполненные с помощью строки запроса на расширенный синтаксис запроса (AQS) в ходе [операции FindItem](http://msdn.microsoft.com/library/ebad6aae-16e7-44de-ae63-a95b24539729%28Office.15%29.aspx).
  
Можно выполнить поиск в папке почтового ящика Exchange двумя способами:
  
- С помощью поискового запроса хранилища Exchange, который выполняет последовательного сканирования всех сообщений в целевой области поиска.
    
- С помощью службы поиска Exchange (индексирование содержимого).
    
Обе эти типы операций поиска может привести к времени ожидания. По возможности следует используйте службу поиска Exchange, так как поиск часто предназначены для почтового ящика индексов и использовать AQS запросы. Следующем примере показано, как выполнить поиск AQS папки «Входящие» с помощью веб-служб Exchange и службу поиска Exchange.
  
```cs
ItemView iv = new ItemView(1000);
FindItemsResults<Item> fiitems = service.FindItems(WellKnownFolderName.Inbox, "subject:football", iv);
```

Если нельзя использовать поискового запроса AQS, не используйте фильтры сложной поиска. Также старайтесь не создавать фильтры поиска на основе вычисляемых значений, если запрос включает в себя расширенные свойства MAPI. Поиск AQS появился в Exchange 2010.
  
> [!NOTE]
> При первом выполнении запроса поиска сложных Exchange хранилища, он работает очень медленно и может времени ожидания. После этого запрос будет отвечать быстрее. Дополнительные сведения о сервере Exchange server процессы во Exchange хранилища поисковых запросов, просмотреть [Общее представление о производительности воздействия из высокой элемента счетчиков и ограниченные представления](http://technet.microsoft.com/en-us/library/cc535025%28EXCHG.80%29.aspx) на сайте TechNet. С помощью **SearchFilter** создает динамические ограничение, которое помогает похожих запросов в будущем, но поскольку эти ограничения динамических характер, они не было постоянным или надежные и удаляются по истечении не более трех дней. 
  
Параметр политики **EWSFindCountLimit** указывает максимальное число элементов из результатов **FindItem** или **FindFolder** операции, которые могут находиться в памяти на сервере клиентского доступа, в то же время для одного пользователя. Каждый элемент или папку, который обрабатывает веб-служб Exchange в запрос **FindItem** или **FindFolder** учитывается по бюджету, заданная в элементе **EWSFindCountLimit** . Если ответ обратно в источник запроса, освобождается накладных count поиска для текущего вызова. Ответ, сервер возвращает инициатору при превышении бюджета на основе значения элемента **RequestServerVersion** и ли источник запроса указан разбиение на страницы. Когда значение элемента **RequestServerVersion** указывает Exchange 2010 или более ранняя версия Exchange, сервер отправляет ответ ошибки с кодом ошибки **ErrorServerBusy**. Если значение элемента **RequestServerVersion** указывает версию обмена начиная с Exchange 2010 с пакетом обновления 1 или Exchange Online, а клиент использует разбиение на страницы, веб-служб Exchange может возвращать частичный результирующий набор вместо ошибку. Приложение следует ожидать, что веб-служб Exchange не может возвращать все элементы. Если значение элемента **IncludesLastItemInRange** имеет значение false, приложение следует сделать другой **FindItem** или **FindFolder** запрос с помощью нового смещения и продолжить элемент **IncludesLastItemInRange** возвращает false. 
  
При использовании операции **FindItem** или **FindFolder** важно использовать разбиение на страницы. Управляемый API EWS контролирует использование разбиение на страницы, но если вы используете другие методы, такие как объекты прокси-сервера веб-служб Exchange или необработанные SOAP, необходимо явно задать разбиение на страницы. Следующем примере показано, как использовать разбиение на страницы в управляемый API веб-служб Exchange. 
  
```cs
ItemView iv = new ItemView(1000);
FindItemsResults<Item> fiFindItemResults = service.FindItems(WellKnownFolderName.Inbox, iv);
```

> [!NOTE]
> Политики по умолчанию в Exchange ограничивает размер страницы, чтобы 1000 элементов. Установка размера страницы в значение, которое больше, чем это число не имеет практического эффекта. 
  
Приложения должны также учетной записи для того факта, что _EWSFindCountLimit_ регулирование значение параметра может привести к частичный результирующий набор, возвращаемых для приложений, которые делают параллельных запросов. Приведенный ниже показано, как использовать свойство **MoreAvailable** в управляемый API веб-служб Exchange, чтобы убедиться, что все результаты включаются в запросе. 
  
```cs
ItemView iv = new ItemView(1000);
service.TraceEnabled = false;
FindItemsResults<Item> fiResults = null;
Do 
{
    fiResults = service.FindItems(WellKnownFolderName.Inbox, iv);
    PropertySet itItemPropSet = new PropertySet(BasePropertySet.IdOnly) { EmailMessageSchema.Body };
    //Process Items in Result Set
    iv.Offset += fiResults.Items.Count;
}
while (fiResults.MoreAvailable == true);
```

## <a name="throttling-policies-and-concurrency"></a>Параллелизм и политик регулирования
<a name="bk_ThrottlingConcurrency"> </a>

Параллелизм относится к число подключений из определенного пользователя. Подключение удерживается с момента, что запрос будет получен до отправки ответа для инициатора запроса. Если пользователь попытается сделать более параллельных запросов, чем позволяет эта политика, не удается выполнить новые попытки подключения. Тем не менее существующие подключения остаются действительными. Политики регулирования может повлиять на параллелизм несколько различных способов.
  
Параметр политики регулирования **EWSMaxConcurrency** задает число одновременных подключений, определенного пользователя, у которых есть от Exchange server за один раз. Чтобы определить максимальное число одновременных подключений, чтобы разрешить, рассмотрите возможность подключения, которые будут использовать клиенты Outlook. Outlook 2007 и Outlook 2010 используйте веб-служб Exchange для доступа к доступности и сведения об отсутствии на работе Office (отсутствие на работе). Outlook 2011 для Mac все функциональные возможности клиентского доступа с помощью веб-служб Exchange. В зависимости от числа клиентов Outlook, которые подключаться к почтовым ящиком пользователя число одновременных подключений, доступных для пользователя может быть ограниченный. Кроме того Если ваше приложение должно подключиться к нескольким почтовым ящикам одновременно во время использования контекст безопасности, важно учитывать значение политики **EWSMaxConcurrency** . Дополнительные сведения об использовании контекст безопасности с одновременными подключениями см.в [Рассмотрение регулирования для приложений, применяющих олицетворение EWS](http://msdn.microsoft.com/library/961f773a-8b8e-4b4f-a4b9-64305e107ca4.aspx#bk_ThrottlingConsiderations) ранее в этой статье. 
  
Приложения, которые одновременно подключаться к нескольким почтовым ящикам нужно иметь возможность отслеживать использование ресурсов на стороне клиента. Так как операции EWS основаны на запроса и ответа, можно обеспечить работу приложения в пределах порог **EWSMaxConcurrency** путем отслеживания число подключений, которые происходят от начала запрос и ответ Получено и проверка того, что не более десяти откройте запросы выполняться одновременно. 
  
Этот параметр политики **EWSFindCountLimit** указывает размер максимальное результатов, которые **FindItem** или **FindFolder** операции можно использовать на сервере клиентского доступа в то же время для одного пользователя. Если приложение (или потенциально несколькими приложениями) делает два параллельных запросов веб-служб Exchange **FindItem** , возвращающие 100 элементов для определенного пользователя, накладных **EWSFindCountLimit** от бюджета этой определенного пользователя будет 200. При возврате первый запрос, бюджета работает на 100 и при возврате второй запрос бюджета удаляет нулевое значение. Если же приложения для выполнения двух одновременных запросов 1000 элементов, значение бюджета будет 2000 элементов которого превышает значение **EWSFindCountLimit** . Бюджет пользователя для элементов падает ниже нулю, следующего запроса приведет к ошибке до питает бюджет пользователя к одному или нескольким. 
  
## <a name="throttling-considerations-for-ews-notification-applications"></a>Регулирование рекомендации для уведомления приложений веб-служб Exchange
<a name="bk_ThrottlingNotifications"> </a>

При создании веб-служб Exchange уведомления, приложения, которые используют push, репликации по запросу, или потоковая передача уведомлений необходимо учитывать последствия **EWSMaxSubscriptions** и политик регулирования **EWSMaxConcurrency** и ** HangingConnectionLimit**. 
  
Этот параметр политики **EWSMaxSubscriptions** указывает максимальное количество активных push, репликации по запросу и потоковой передачи подписок, которые пользователь может выполнять на определенном сервере клиентского доступа в то же время. Различными версиями Exchange иметь разные значения по умолчанию для этого параметра. Пользователь может подписаться на всех папок в почтовом ящике с помощью свойства **SubscribeToAllFolders** — это используется одна подписка по бюджету **EWSMaxSubscriptions** . Пользователи могут подписаться на отдельных папок, с каждой папки подписки подсчет достигло предельного бюджет **EWSMaxSubscriptions** , до предела, задайте значение параметра **EWSMaxSubscriptions** (например, пользователи могут подписаться на 20 календаря папки, в разные почтовые ящики, если **EWSMaxSubscriptions** имеет значение 20). 
  
Сведения о олицетворение и параметр **EWSMaxSubscriptions** содержатся в разделе [регулирование для приложений, применяющих олицетворение EWS](ews-throttling-in-exchange.md#bk_ThrottlingConsiderations) ранее в этой статье. 
  
Параметр политики **EWSMaxConcurrency** можно также приведет к возникновению проблем для уведомления веб-служб Exchange; Например: 
  
- При веб-служб Exchange увеличивает число подключений для владелец подписки во время уведомления создается путем принудительной подписки.
    
- Когда приложение, предназначенное для прослушивания нескольких почтовых ящиков пользователей, а пользователи получают одновременных уведомлений для экземпляра сообщения, отправляемые в список рассылки.
    
Если приложение уведомлений многопотоковость и выполняет запросы одновременных подключений для получения дополнительных сведений о конкретное сообщение, которое было получено с помощью учетной записи пользователя, может быть превышено ограничение политики **EWSMaxConcurrency** . С учетом этого, рассмотрите возможность мониторинга одновременных подключений в приложении, включая те, которые могут использоваться сервером и реализация очереди на стороне клиента. 
  
**HangingConnectionLimit** применима только для потоковой передачи уведомлений. Это ограничение устанавливается в файле web.config, что означает, что администратор Exchange может установить это значение на сервере Exchange в локальной, но почтовых ящиков Exchange Online необходимо использовать значение по умолчанию для этого ограничения, который является 3 для Exchange Online и Exchange 2013. Чтобы получить дополнительные сведения, обратитесь к разделу [регулирования значения необходимо принять во внимание?](how-to-maintain-affinity-between-group-of-subscriptions-and-mailbox-server.md#bk_throttling).
  
## <a name="throttling-policy-and-application-performance"></a>Регулирование производительности политики и приложений
<a name="bk_PercentTimeIn"> </a>

Следующие три параметра **PercentTimeIn** политики регулирования влияет на количество времени, которое может использовать приложение веб-служб Exchange на сервере клиентского доступа: 
  
- **EWSPercentTimeInAD**
    
- **EWSPercentTimeInCAS**
    
- **EWSPercentTimeInMailboxRPC**
    
Значения, заданные в параметры политики **PercentTimeIn** указывает количество времени, выделяемый один поток один запрос. Например, в процессе Если значение **EWSPercentTimeInCAS** 90, если процесс предоставляет два параллельных запросов, которые затрачиваться 54 секунды каждого выполнение кода на сервере клиентского доступа, используется 108 секунд в 60 секунд окно. Представляет значение параметра **EWSPercentTimeInCAS** 180 процентов. 
  
> [!NOTE]
> Значение параметра **EWSPercentTimeInCAS** является перекрывающиеся расширенный набор значений параметров **EWSPercentTimeInAD** и **EWSPercentTimeInMailboxRPC** стандартов. Это означает, что управления затратами времени обработки сервера клиентского доступа всегда больше, чем расходы в **EWSPercentTimeInAD** и **EWSPercentTimeInMailboxRPC**. Это так, как компонент Exchange, сделайте Active Directory или RPC вызов, он должен уже работать кода сервера клиентского доступа. Кроме того управления затратами времени обработки для **EWSPercentTimeInCAS** не останавливается при LDAP или выполняются вызовы RPC. Несмотря на то, что запрос синхронно может ожидать ответа из доменных служб Active Directory (AD DS) или хранилища Exchange, процесс по-прежнему потребляет слишком потоков на сервере, и таким образом поток должны продолжать начисления для такого использования. 
  
Количество времени ЦП, приложение может потребоваться в течение 60 секунд может превысить эти регулирование ограничения; Таким образом необходимо принять во внимание такого объема и типа запросов, которые были сделаны. Например большого количества операций **ResolveNames** , внесенных одновременно может превышать значение параметра политики **EWSPercentTimeInAD** . Значения политики, содержащиеся в политики регулирования по умолчанию, обеспечивают большинство приложений веб-служб Exchange для работы без проблем; Тем не менее когда многопоточных приложений большого объема поставить большое количество запросов на одном конкретном сервере клиентского доступа, это может вызвать проблемы. Чтобы избежать этого, рассмотрите возможность ограничивать размер пакетов, которые требуется выполнить на сервере. 
  
## <a name="throttling-policies-and-applications-that-send-a-large-volume-of-email"></a>Регулирование политики и приложений, которые отправляют большой объем электронной почты
<a name="bk_RateLimits"> </a>

Политики регулирования по умолчанию включают три скорость ограничение параметры политики, которые могут повлиять на приложения, использующие веб-служб Exchange для отправки больших объемов сообщения или отправлять сообщения в большие пакеты в короткий промежуток времени. 
  
> [!NOTE]
> В общем случае рекомендуется использовать веб-служб Exchange для отправки массовыми сообщениями электронной почты. Используйте SMTP-узел, который занимается массового служб почты для отправки сообщений электронной почты с постоянным больших массовых. 
  
Параметр политики **MessageRateLimit** указывает количество сообщений в минуту, который может отправлять любой клиент Exchange, включая веб-служб Exchange. По умолчанию этой политики значение 30 сообщений в минуту. Для обычных пользователей это правило, достаточно. Тем не менее приложения, например отправлять большие пакеты сообщений электронной почты в рамках выставления счетов программы, могут возникать проблемы. При превышении этого ограничения политики задерживается доставки сообщений для почтового ящика. В частности сообщения будут отображаться в папке «Черновики» или исходящих сообщений для длительных периодов времени, когда пользователь или приложение отправляет большее число сообщений, чем значение, указанное с помощью параметра **MessageRateLimit** . Убедитесь в том, что следует учитывать это при разработке доставки, отслеживания системы, особенно в том случае, если приложение использует почтовый ящик, пользователи подключения через Outlook. Когда отложенная элементы хранятся в папке «Черновики» или исходящих сообщений, пользователи может интерпретировать, как ошибка. 
  
Этот параметр политики **RecipientRateLimit** указывает ограничение на количество получателей, которые пользователь может адресовать в течение 24 часов. К примеру имеет значение 500, означает, что одной учетной записи почтового ящика Exchange может отправлять сообщения не более 500 получателей день. Это ограничение применяется к сообщениям получателям, внутри и за пределами организации. Это ограничение по умолчанию может вызвать проблемы для некоторых бизнес-приложений, запускается конечных месяца создания счетов-фактур и необходимы для отправки сообщений для более чем это число получателей. Можно использовать внешних служб, которые позволяют пакетной обработки сообщений или отдельных локальных исходящих ретрансляции решений, чтобы обойти данное ограничение. 
  
Этот параметр политики **ForwardeeLimit** указывает максимальное количество получателей, что сообщения могут переслано или перенаправление на с помощью правила папки «Входящие». Этот параметр не ограничить число сообщений, пересылку или перенаправление в список получателей. 
  
## <a name="errors-generated-when-throttling-limits-are-exceeded"></a>Превышено ошибки, возникающие при пределы регулирования
<a name="bk_ThrottlingErrors"> </a>

Регулирование политик при превышении предельных, веб-служб Exchange создает один из ошибок, перечисленных в следующей таблице.
  
**В таблице 3: Регулирование ограничение ошибки**

|**Error**|**Параметр для политики регулирования**|**Описание**|
|:-----|:-----|:-----|
|ErrorExceededConnectionCount  <br/> |**EWSMaxConcurrency** <br/> |Указывает, что количество параллельных запросов на сервере, чем разрешено политикой пользователя.  <br/> |
|ErrorExceededSubscriptionCount  <br/> |**EWSMaxSubscriptions** <br/> |Указывает, что пользователь регулирование политики, которую превышено максимальное подписки число.  <br/> |
|ErrorExceededFindCountLimit  <br/> |**EWSFindCountLimit** <br/> |Указывает, что вызов операции поиска превысил общее число элементов, которые могут быть возвращены.  <br/> |
|ErrorServerBusy  <br/> |**EWSPercentTimeInMailboxRPC** **EWSPercentTimeInCAS** **EWSPercentTimeInAD**                   <br/> |Происходит, когда сервер занят. Значение BackOffMilliseconds, возвращаемых с ошибками, ErrorServerBusy клиенту указывает количество времени, он должен ожидать до его следует повторно отправить запрос, вызвавший ответ, возвращаемых этот код ошибки.  <br/> |
   
В следующей таблице перечислены коды состояния HTTP, возвращаемые регулирование ошибки.
  
**В таблице 4: Возвращаемые регулирование ошибки коды состояния HTTP**

|**Код состояния HTTP**|**Описание**|
|:-----|:-----|
|HTTP 503  <br/> |Указывает, что запросы веб-служб Exchange организация очереди с помощью служб IIS. Клиент должен отложить отправлять дополнительные запросы на более поздний срок.  <br/> |
|HTTP 500  <br/> |Отображается сообщение об ошибке внутреннего сервера с кодом ошибки ErrorServerBusy. Это указывает на то, что клиент должен отложить отправлять дополнительные запросы на более поздний срок. Ответ может содержать пассивный подсказку, называется BackOffMilliseconds. Если этот параметр указан, следует использовать значение BackOffMilliseconds в качестве во время выполнения, пока не отправляет клиенту повторно запрос.  <br/> |
|HTTP 200  <br/> |Содержит веб-служб Exchange на основе схемы ошибку с кодом ошибки ErrorInternalServerError. Внутренний код ошибки ErrorServerBusy может быть указан. Это указывает на то, что клиент должен отложить отправлять дополнительные запросы на более поздний срок.  <br/> |
   
## <a name="see-also"></a>См. также

- [Управление рабочими нагрузками Exchange](http://technet.microsoft.com/en-us/library/jj150503.aspx)
- [Командлет нового ThrottlingPolicy](http://technet.microsoft.com/en-us/library/dd351045.aspx)
- [Общее представление о политиках регулирования клиентов](http://technet.microsoft.com/en-us/library/dd297964.aspx)
- [Класс ThrottlingPolicy](http://msdn.microsoft.com/en-us/library/ff342496%28v=EXCHG.140%29.aspx)
- [Политик регулирования и EWSFindCountLimit](http://blogs.msdn.com/b/exchangedev/archive/2010/03/12/throttling-policies-and-the-ewsfindcountlimit.aspx)
- [Моментальные снимки бюджета в журналах IIS](http://blogs.msdn.com/b/exchangedev/archive/2010/03/10/budget-snapshots-in-the-iis-logs.aspx)
- [Эффекты регулирования на развертывание в Exchange 2010 с пакетом обновления 1](http://msexchangeteam.com/archive/2010/08/27/456040.aspx)
- [Политики регулирования, связи в Exchange 2010 с пакетом обновления 1](http://msexchangeteam.com/archive/2010/08/02/455707.aspx)
- [Политик регулирования и CPUStartPercent](http://blogs.msdn.com/b/exchangedev/archive/2010/03/11/throttling-policies-and-cpustartpercent.aspx)
- [Олицетворение и EWS в Exchange](impersonation-and-ews-in-exchange.md)
    

