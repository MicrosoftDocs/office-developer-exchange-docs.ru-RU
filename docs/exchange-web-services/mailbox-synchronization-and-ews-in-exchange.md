---
title: Синхронизация почтового ящика и веб-службах Exchange
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: decf1eee-9743-44f3-9333-b3a01af3683e
description: Узнайте, как работает синхронизации почтового ящика, при использовании веб-служб Exchange для доступа к Exchange.
ms.openlocfilehash: 7bca2f7b754dcceee99e4bc24519f6e4f6423ae7
ms.sourcegitcommit: 34041125dc8c5f993b21cebfc4f8b72f0fd2cb6f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19761161"
---
# <a name="mailbox-synchronization-and-ews-in-exchange"></a>Синхронизация почтового ящика и веб-службах Exchange

Узнайте, как работает синхронизации почтового ящика, при использовании веб-служб Exchange для доступа к Exchange.
  
ВЕБ-службах Exchange используется два типа синхронизации для получения содержимого почтового ящика и изменения содержимого почтового ящика:
  
- Синхронизация папок
    
- Элемент синхронизации
    
В этой статье рассказывается о как типы синхронизации, как работает синхронизации, шаблоны проектирования синхронизации и рекомендации по синхронизации.
  
## <a name="folder-and-item-synchronization"></a>Синхронизация папок и элементов
<a name="bk_typesofsyncs"> </a>

Синхронизация папок синхронизирует структуру папок или иерархии папок. Элемент синхронизации синхронизирует элементов в папке. При синхронизации элементов необходимо синхронизировать каждой папки в почтовом ящике независимо друг от друга. Можно использовать веб-служб Exchange или управляемый API EWS в приложении для реализации папки и синхронизации элемента.
  
**В таблице 1. Операции веб-служб Exchange и методы управляемый API EWS для синхронизации папок и элементов**

|**Операция служб EWS**|**Метод управляемого API EWS**|
|:-----|:-----|
|[SyncFolderHierarchy](http://msdn.microsoft.com/library/b31916b1-bc6c-4451-a475-b7c5417f752d%28Office.15%29.aspx) <br/> |[Метод ExchangeService.SyncFolderHierarchy](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservice.syncfolderhierarchy%28v=exchg.80%29.aspx) <br/> |
|[SyncFolderItems](http://msdn.microsoft.com/library/7f0de089-8876-47ec-a871-df118ceae75d%28Office.15%29.aspx) <br/> |[Метод ExchangeService.SyncFolderItems](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservice.syncfolderitems%28v=exchg.80%29.aspx) <br/> |
   
Область синхронизации, которая происходит отличается в зависимости от того, будет ли это начальные и текущие синхронизации, как показано ниже:
  
- Начальная синхронизация синхронизирует все папках или элементов на сервере для клиента. После первоначальной синхронизации клиент имеет состояние синхронизации, в которой хранятся для последующие синхронизации. Состояние синхронизации представляет все изменения на сервере, на сервере передан клиенту.
    
- Постоянная синхронизация синхронизировать все элементы или папки, которые были добавлены, удалены или изменены с момента предыдущей синхронизации. Состояние синхронизации используется сервером для расчета изменения сообщение о клиенту во время каждого из циклов текущей синхронизации.
    
Каждый метод синхронизации или операции возвращает список изменений, не фактический папки или сообщения, которые изменены. Сообщает изменения элементов и папок с помощью следующие типы изменений:
  
- Создание — Указывает, что новый элемент или папки должен быть создан на стороне клиента.
    
- Обновление — Указывает, что элемент или папку, должны изменяться на стороне клиента.
    
- DELETE — Указывает, что следует удалить элемент или папку на стороне клиента.
    
- ReadStateChange для веб-служб Exchange или ReadFlagChange для управляемого API EWS — указывает, что состояние чтения элемента стала теперь областью, либо из непрочитанные сообщения на чтение или чтение непрочитанные сообщения.
    
В Exchange Online, Exchange Online как часть Office 365 и версии Exchange, начиная с Exchange 2010 SP2 элементов и папок возвращаются в порядке от новых к старым. В предыдущих версиях Exchange элементов и папок возвращаются от более ранних к более поздним.
  
## <a name="how-does-ews-synchronization-work"></a>Каков принцип работы синхронизации веб-служб Exchange?
<a name="bk_howdoesitwork"> </a>

В двух словах при синхронизации почтового ящика в первый раз, используйте процесс, как показано на рисунке 1. Несмотря на то, что можно использовать другие [шаблоны проектирования синхронизации](mailbox-synchronization-and-ews-in-exchange.md#bk_syncpatterns), мы рекомендуем этот подход для масштабируемых приложений.
  
**На рисунке 1. Шаблон разработки начальной синхронизации**

![Иллюстрация, показывающая шаблон проектирования начальной синхронизации. Клиент вызывает методы SyncFolderHierarchy и Load или GetItem, чтобы получить папки, затем вызывает методы SyncFolderItems и LoadPropertiesForItems или GetItem, чтобы получить элементы каждой папки.](media/Exchange2013_SyncInitial.png)
  
Если вы используете существующее состояние синхронизации на стороне клиента для синхронизации почтового ящика, рекомендуется реализовать шаблон разработки, как показано на рисунке 2. 
  
**На рисунке 2. Шаблон разработки текущей синхронизации**

![Иллюстрация, показывающая шаблон проектирования текущей синхронизации. Клиент получает уведомление, а затем вызывает метод SyncFolderHierarchy или SyncFolderItems, получает свойства, после чего обновляет клиент или флаг чтения.](media/Exchange2013_Sync_Ongoing.png)
  
## <a name="synchronization-design-patterns"></a>Шаблоны проектирования синхронизации
<a name="bk_syncpatterns"> </a>

Можно использовать один из двух шаблоны проектирования синхронизации в приложении обновлять ваши почтовые ящики: синхронизации на основе уведомлений или подход только для синхронизации.
  
Синхронизации на основе уведомлений, как показано на [рисунке 2](mailbox-synchronization-and-ews-in-exchange.md#bk_howdoesitwork), зависит от уведомлений для оповещения клиента, чтобы вызвать методы управляемый API EWS [SyncFolderItems](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservice.syncfolderitems%28v=exchg.80%29.aspx) или [SyncFolderHierarchy](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservice.syncfolderhierarchy%28v=exchg.80%29.aspx) или веб-служб Exchange [SyncFolderHierarchy ](http://msdn.microsoft.com/library/b31916b1-bc6c-4451-a475-b7c5417f752d%28Office.15%29.aspx)или [SyncFolderItems](http://msdn.microsoft.com/library/7f0de089-8876-47ec-a871-df118ceae75d%28Office.15%29.aspx) операций. Этот тип синхронизации обычно рекомендуется использовать для масштабирования приложений, но может быть лучший подход для всех пользователей. На основе уведомлений синхронизации имеет следующие преимущества: 
  
- Уведомления о оптимизированных для уменьшения вызовов в серверной базе данных Exchange. События очереди и подписок управляются с сервера почтовых ящиков (или сервера клиентского доступа в Exchange 2010 и Exchange 2007); Тем не менее управление событий и подписок использует меньше ресурсов, чем вариант, который является более частое синхронизации обращений к базе данных Exchange. Кроме того Exchange имеет определенные [политики регулирования](ews-throttling-in-exchange.md) для уведомлений и подписки, для защиты потребления ресурсов. 
    
Тем не менее существует также несколько недостатков с помощью синхронизации на основе уведомлений.
  
- Уведомления о являются помехами, так как для большинства вариантов включать несколько уведомлений для одного пользователя цель. Это особенно важно папки календаря. Например при получении одного приглашения на собрание несколько уведомлений элемента и папки создаются, включая уведомления для создания элемента, а другой для изменения элемента. Одним из способов устранения этой недостаток – Создание задержка несколько секунд в [нагрузки](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.serviceobject.load%28v=exchg.80%29.aspx), [LoadPropertiesForItems](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservice.loadpropertiesforitems%28v=exchg.80%29.aspx), [GetItem](http://msdn.microsoft.com/en-us/library/exchange/aa565934%28v=exchg.150%29.aspx.aspx)или [GetFolder](http://msdn.microsoft.com/en-us/library/exchange/aa580274%28v=exchg.150%29.aspx.aspx) звонков. В случае приглашения на собрание Если вы внесли вызовов операции **GetItem** немедленно, может иметь один вызов для создания элемента, а другой для изменения элемента. Вместо этого задержки звонка, можно вызвать операции **GetItem** один раз и проводить изменения, которые охватывают создания и изменения элемента в то же время. 
    
- Уведомления в очереди на сервере почтовых ящиков и подписки будут сохранены на сервере почтовых ящиков. В случае недоступности сервера почтовых ящиков, который управляет подписки теряется никаких уведомлений о новых, ваш почтовый ящик не синхронизировать и потребуется повторная уведомления.
    
- Вам потребуется Планирование стратегии устранения в случае, если уведомления с ошибкой. Таким образом, второй способ шаблон проектирования только для синхронизации, устойчива более чем синхронизации на основе уведомлений, из-за только что клиент поддержка состояния синхронизации — отсутствуют проблемы с сходства на сервер почтовых ящиков Управление подпиской.
    
Если реализован в соответствии с рекомендациями, шаблон проектирования подписки на основе уведомлений зависит от: 
  
- Уведомления о определить, *Когда* данные изменены. 
    
- Управляемый API EWS **SyncFolderHierarchy** или методы **SyncFolderItems** или веб-служб Exchange **SyncFolderHierarchy** или **SyncFolderItems** операций чтобы определить, *какие* изменяется, оптимизация число возвращаемых событий синхронизации. Был элемент создан, обновлении или удалении? Это все, необходимо знать из этих методов, не используйте их для свойства список изменений. (Не **GetItem** или **LoadPropertiesForItems** звонок на все элементы или папки возвращаемых). 
    
- С помощью методов **нагрузки** или **LoadPropertiesForItems** в управляемый API EWS или операции EWS **GetItem** для определения *способа* данные изменены и для получения свойств с сервера при необходимости, организация пакетные запросы на основе на объем данных, которые будут возвращены. Это следует сравнение свойств в клиенте и на их только что возвращенный с сервера и в конечном счете создания, удаления или изменения элемента или папки на стороне клиента. 
    
Подход только для синхронизации полностью зависит от методов **SyncFolderItems** и управляемый API EWS **SyncFolderHierarchy** , или **SyncFolderHierarchy** или веб-служб Exchange **SyncFolderItems** операции, которые можно вызвать либо постоянно или как запланированного задания. Существует, преимущества и недостатки для этого параметра также. Только для синхронизации подход устойчивости, так как состояние синхронизации хранится на стороне клиента на уровне почтового ящика и отношения между состояние синхронизации и любого сервера почтовых ящиков, который поддерживает подписки на уведомления не требуется. Подход синхронизации способное перемещения почтовых ящиков из-за его независимости от сервера почтовых ящиков. Тем не менее, подход синхронизации увеличивает задержку для пользователя, так как синхронизации элементов на основе времени или временная — не в режиме реального времени при получении сообщения. Такой подход также дороже, так как вы выполняете обращений к базе данных Exchange по возможности, что изменений внесено не было. 
  
## <a name="synchronization-best-practices"></a>Рекомендации по синхронизации
<a name="bk_bestpractices"> </a>

Для приложений, хорошо масштабируемое рекомендуется выполнить следующие рекомендации для синхронизации почтовых ящиков в приложении:
  
- При вызове метода управляемый API EWS **SyncFolderItems** или **SyncFolderHierarchy** использовать значение _IdOnly_ для параметра _propertySet_ или при использовании веб-служб Exchange **SyncFolderHierarchy** или **SyncFolderItems** операции используйте значение **IdOnly** для [BaseShape](http://msdn.microsoft.com/library/42c04f3b-abaa-4197-a3d6-d21677ffb1c0%28Office.15%29.aspx) значения для уменьшения обращений к базе данных Exchange. Дополнительные свойства, которые вы запрашиваете в наборе свойств **SyncFolderItems** или **SyncFolderHierarchy** позвонить, дополнительные базы данных создаются вызовы. Новый вызов RPC выполняется для каждого запроса, значения свойств в то время как только один вызов RPC выполняется для извлечения всех **что ItemID** для запроса - независимо от того, количество результатов для отчета. Поэтому запрос **IdOnly** приводит к вызова одной базы данных, тогда как запрос контейнер свойств темы и отправителя приводит к три обращений к базе данных: один для **темы**, **отправителя**и **идентификатор элемента**.
    
- Не вызвать методы управляемый API EWS **нагрузки** или **LoadPropertiesForItems** или веб-служб Exchange **GetItem** или **GetFolder** операций, для каждого элемента в ответ синхронизации. Вместо этого анализа результатов; как искать изменения, которые не требуют все свойства, которые нужно извлечь, прочитайте изменения состояния. Если ответ содержит изменить состояние чтения, просто обновить флаг на стороне клиента и завершения; не требуется, чтобы получить все свойства элемента. И убедитесь в том, что не дублируется усилий при внесении изменений, которые исходит от одного клиента. Например если ответа синхронизации включает в себя удаления элемента и удаление произошло в локальном клиенте, не требуется удалить сообщение еще раз или получить все свойства для этого элемента. 
    
- Избегайте начало ограничением, выполнив следующие:
    
  - При вызове метода управляемый API EWS **LoadPropertiesForItems** или операции EWS **GetItem** для получения элементов в пакете, не пакета слишком большого числа элементов в запросе; в противном случае вы получаете [регулирование](ews-throttling-in-exchange.md). Рекомендуется включить 10 элементов в пакете.
    
  - Не выполнение слишком большого числа запросов в слишком короткое время. Это будет также привести к регулирования и к увеличению времени ответа, а не Сократите его. 
    
  - Если группировка элементов, пакетного все элементы, имеющие те же значения для атрибутов **Id** и **ChangeKey** элемент [FolderId](http://msdn.microsoft.com/library/00d14e3e-4365-4f21-8f88-eaeea73b9bf7%28Office.15%29.aspx) . 
    
  - Если вы получите ограничением, остановите отправлять запросы. Повторная отправка запросов будет продолжить восстановление усилий. Вместо этого пассивный истечения времени ожидания, а затем повторите попытку отправки запросов к синхронизации.
    
- В зависимости от типа [события уведомления](notification-subscriptions-mailbox-events-and-ews-in-exchange.md#bk_eventtypes) получено: 
    
  - Для событий **NewMail** или **изменено** вызова метода управляемый API EWS **SyncFolderItems** или операции EWS **SyncFolderItems** так как уведомления не предоставляют **ChangeKey**и уведомления не указывают состояние чтения изменения.
    
  - Для **удаленных** событий Если подписки на уведомления было активной до предыдущей синхронизации, просто удалите события локально. Вызовите метод управляемый API EWS **SyncFolderItems** или операции EWS **SyncFolderItems** сразу же после удаления не требуется. 
    
  - Если **изменено** событие было вызвано изменение состояние чтения, не вызовите метод управляемый API EWS **LoadPropertiesForItems** или операции EWS **GetItem** , замените флаг для элемента. 
    
- При синхронизации данных календаря, выполните следующие действия:
    
  - Используйте подобного синхронизации на основе уведомлений. Так как **SyncFolderItem** не содержит логику календаря, используйте метод управляемый API EWS [FindAppointments](http://msdn.microsoft.com/en-us/library/dd633767%28v=exchg.80%29.aspx) или веб-служб Exchange [операции FindItem](http://msdn.microsoft.com/library/ebad6aae-16e7-44de-ae63-a95b24539729%28Office.15%29.aspx) с элементом [представления календаря](http://msdn.microsoft.com/library/a4a953b8-0710-416c-95ef-59e51eba9982%28Office.15%29.aspx) для просмотра встреч между двумя датами, а затем Вызовите метод управляемый API EWS **LoadPropertiesForItems** или операции EWS **GetItem** для извлечения свойств элемента для элемента календаря. 
    
  - Не опроса с помощью метода управляемый API EWS **FindAppointments** или операции EWS **FindItem** с элементом **представления календаря** . 
    
- При синхронизации папки поиска:
    
  - Используйте подобного синхронизации на основе уведомлений. 
    
  - Использование уведомлений о для определения при изменении данных.
    
  - Так как **SyncFolderItem** нельзя использовать в папке поиска, используйте метод управляемый API EWS [FindItems](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservice.finditems%28v=exchg.80%29.aspx) сортировки и выгружаемый или операции EWS **FindItem** с набором элемент [FractionalPageItemView](http://msdn.microsoft.com/library/4111afec-35e7-4c6f-b291-9bbba603f633%28Office.15%29.aspx) и [SortOrder](http://msdn.microsoft.com/library/c2413f0b-8c03-46ae-9990-13338b3c53a6%28Office.15%29.aspx) для определения отличия. 
    
  - Используйте метод управляемый API EWS **LoadPropertiesForItems** или операции EWS **GetItem** для извлечения данных. 
    
## <a name="filtered-synchronization"></a>Синхронизация с фильтрацией
<a name="bk_filteredsync"> </a>

Управляемый API EWS **SyncFolderItems** метод и операции EWS **SyncFolderItems** позволяют игнорировать определенные элементы, на основании их что ItemID, установив параметр _ignoreItemIds_ в управляемый API EWS или [Пропустить](http://msdn.microsoft.com/library/7789eec5-ceec-43f2-84d5-d0d15b734076%28Office.15%29.aspx) элемент в веб-служб Exchange. Идеально подходит, например, для отдельных пользователей приступить к ответить всем полученного сообщения электронной почты для всех сотрудников компании. 
  
Может возникнуть вопрос, можно ли фильтрации личных уведомлений (и поэтому запуск синхронизации) при изменении определенных свойств? Несмотря на то, что кажется приемлемой, так как подписки на уведомления о основаны на тип изменения (Создание, обновление, удаление), и не свойство обновляется, вам не удается применить фильтр уведомлений таким образом. Вместо этого можно сделать следующее:
  
- Используйте шаблон проектирования подписки на основе уведомлений.
    
- Вызовите управляемый API EWS **SyncFolderItems** и методы **SyncFolderHierarchy** несколько раз с параметром _propertySet_ , установите значение _IdOnly_ , чтобы сделать текущего состояния синхронизации. Или при использовании веб-служб Exchange, вызовите **SyncFolderHierarchy** и операции **SyncFolderItems** несколько раз с **BaseShape** значение **IdOnly**. 
    
- Отменить ответа (не его обработки или выполните любое сравнение свойств).
    
- Используйте метод управляемый API EWS **FindItems** или операции EWS **FindItem** и сортировка и страницы для предварительного заполнения элементов в отфильтрованные области, который требуется. 
    
- Используйте состояние синхронизации вызовите метод управляемый API EWS **SyncFolderItems** или операции EWS **SyncFolderItems** , но только отслеживать изменения в наборе отфильтрованные элемента. Если создаются новые элементы, вам придется являются ли эти новые элементы в пределах отфильтрованные области. 
    
## <a name="in-this-section"></a>В этом разделе
<a name="bk_filteredsync"> </a>

- [Синхронизация папок с помощью веб-служб Exchange в Exchange](how-to-synchronize-folders-by-using-ews-in-exchange.md)
    
- [Синхронизация элементов с помощью веб-служб Exchange в Exchange](how-to-synchronize-items-by-using-ews-in-exchange.md)
    
- [Обработка ошибок, связанных с синхронизации в веб-служб Exchange в Exchange](handling-synchronization-related-errors-in-ews-in-exchange.md)
    
## <a name="see-also"></a>См. также


- [Разработка клиентов веб-служб для Exchange](develop-web-service-clients-for-exchange.md)
    
- [Метод SyncFolderItems](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservice.syncfolderitems%28v=exchg.80%29.aspx)
    
- [Метод SyncFolderHierarchy](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservice.syncfolderhierarchy%28v=exchg.80%29.aspx)
    
- [Операция SyncFolderHierarchy](http://msdn.microsoft.com/library/b31916b1-bc6c-4451-a475-b7c5417f752d%28Office.15%29.aspx)
    
- [Операция SyncFolderItems](http://msdn.microsoft.com/library/7f0de089-8876-47ec-a871-df118ceae75d%28Office.15%29.aspx)
    

