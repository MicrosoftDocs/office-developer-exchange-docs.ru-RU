---
title: Поиск и веб-службах Exchange
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: 9fa5b836-857e-401d-9450-51e7dbc69104
description: Узнайте, как искать элементы в Exchange с помощью управляемого API EWS или EWS.
ms.openlocfilehash: d35cc74ab2fa79530ac09256e315a780023d833b
ms.sourcegitcommit: 88ec988f2bb67c1866d06b361615f3674a24e795
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2020
ms.locfileid: "44463839"
---
# <a name="search-and-ews-in-exchange"></a>Поиск и веб-службах Exchange

Узнайте, как искать элементы в Exchange с помощью управляемого API EWS или EWS.

Не похоже на этом? Вы захотите запустить проект, который вы отправили для недели, и вам понадобятся сведения о проекте, который ваш руководитель отправил вам через электронную почту назад. В папке "Входящие" есть сотни или, возможно, тысячи сообщений. Чем занимаешься? Прокрутите электронную почту и отменяйте каждую тему и отправителя, пока она не будет найдена. Или вы используете функцию поиска в любимом почтовом клиенте, чтобы быстро получить нулевое значение в зависимости от того, что вам нужно?

Функция поиска, вероятно, является обязательной для любого почтового клиента. Но поиск можно использовать не только для пользователей, но и для поиска в их почтовом ящике. Требуется ли приложению обрабатывать встречи, находящиеся в определенном времени Windows? Возможно, вам потребуется создать отчет по всем элементам задач с определенным состоянием или переместить все контакты с определенным названием компании в другую папку. Поиск поможет вам выполнить все эти требования.

## <a name="search-basics"></a>Основы поиска
<a name="bk_SearchBasics"> </a>

Управляемый API EWS и EWS предоставляют два основных способа указания поиска. Вы можете использовать [Фильтр поиска](how-to-use-search-filters-with-ews-in-exchange.md) или [строку запроса](how-to-perform-an-aqs-search-by-using-ews-in-exchange.md). Используемый способ зависит от цели поиска.

**Таблица 1. Сценарии для фильтров поиска и поисковых запросов**

|**Задача**|**Используйте...**|**Примечания**|
|:-----|:-----|:-----|
|Ограничьте поиск определенным свойством или набором свойств  <br/> |Фильтр поиска  <br/> |Фильтры поиска обеспечивают лучший уровень управления поиском свойств. Несмотря на то, что строки запросов могут ориентироваться на ограниченный набор свойств с помощью расширенного синтаксиса запросов (AQS), фильтры поиска могут ориентироваться на любое свойство.  <br/> |
|Создание поисковых запросов с использованием нескольких условий  <br/> |Фильтр поиска  <br/> |С помощью фильтров поиска можно объединять несколько критериев поиска с логическими смешивать и или или, позволяя выполнять поиски, например "Тема содержит" заметки о собраниях и отправителя равно "Ольга Даниелс" ". Хотя строки запросов также могут соединяться с несколькими критериями поиска, они ограничены набором свойств, которые поддерживаются строками запросов.  <br/> |
|Настраиваемые свойства поиска  <br/> |Фильтр поиска  <br/> |Фильтры поиска могут запланировать настраиваемые свойства. Строки запросов не выполняют поиск настраиваемых свойств.  <br/> |
|Выполнение поиска с учетом регистра символов строкового свойства  <br/> |Фильтр поиска  <br/> |При поиске в строке запроса регистр не учитывается.  <br/> |
|Управление режимом включения при поиске строковые свойства  <br/> |Фильтр поиска  <br/> |Поиск строки запроса всегда выполняет поиск в подстроках. Если вам нужно выполнить поиск по определенным префиксам или требуется точное совпадение, лучше всего подходит фильтр поиска.  <br/> |
|Поиск папок  <br/> |Фильтр поиска  <br/> |EWS не поддерживает поиск папок со строкой запроса.  <br/> |
|Создание папки поиска  <br/> |Фильтр поиска  <br/> |EWS не поддерживает создание папок поиска со строкой запроса.  <br/> |
|Поиск по всем часто используемым свойствам  <br/> |Строка запроса  <br/> |Строки запросов, которые не содержат AQS, будут выполнять поиск по всем часто используемым свойствам. Например, значение строки запроса "МАКК Чавес" возвратит все сообщения, отправленные МАКК Чавес, а также сообщения с "МАКК Чавес" в тексте или теме.  <br/> |
|Создание поиска на основе простого пользовательского ввода  <br/> |Строка запроса  <br/> |Строка запроса — это отличный вариант, позволяющий конечному пользователю выполнять быстрый поиск, вводя простую строку. Так как поиск строки запроса включает все часто используемые свойства, результаты будут содержать все элементы, содержащие условия поиска пользователя.  <br/> |

### <a name="using-a-search-filter"></a>Использование фильтра поиска

Фильтры поиска предоставляют широкий спектр параметров поиска и большую степень контроля над выполнением поиска. Фильтры поиска можно использовать для выполнения базового поиска по совпадению и сравнению, но вы также можете выполнять поиск в содержимом строкового свойства или при сравнении битовой маски.

Например, можно выполнить поиск по содержимому темы элементов с помощью класса [SearchFilter. контаинссубстринг](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.searchfilter.containssubstring%28v=exchg.80%29.aspx) в УПРАВЛЯЕМОМ API EWS. В этом примере создается фильтр поиска для поиска темы для подстроки "заметки к собранию" без учета регистра.

```cs
SearchFilter.ContainsSubstring subjectFilter = new SearchFilter.ContainsSubstring(ItemSchema.Subject,
    "meeting notes", ContainmentMode.Substring, ComparisonMode.IgnoreCase);
```

Кроме того, можно выполнять поиск по настраиваемым свойствам. В этом примере для настраиваемого свойства **итеминдекс** выполняется поиск по значениям, превышающим 3.

```cs
Guid MyAppGuid = new Guid("{AA3DF801-4FC7-401F-BBC1-7C93D6498C2E}");
ExtendedPropertyDefinition customPropDefinition =
    new ExtendedPropertyDefinition(MyAppGuid, "ItemIndex", MapiPropertyType.Integer);
SearchFilter.IsGreaterThan customPropFilter =
    new SearchFilter.IsGreaterThan(customPropDefinition, 3);
```

Кроме того, можно сочетать несколько фильтров поиска для создания более сложных поисков. Например, можно объединить два предыдущих фильтра с логическим и с помощью класса [SearchFilter. SearchFilterCollection](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.searchfilter.searchfiltercollection%28v=exchg.80%29.aspx) .

```cs
SearchFilter.SearchFilterCollection compoundFilter =
    new SearchFilter.SearchFilterCollection(LogicalOperator.And, subjectFilter, customPropFilter);
```

### <a name="using-a-query-string"></a>Использование строки запроса

Строки запросов обеспечивают другой способ поиска. Вы менее контролируете поля, в которых выполняется поиск, и как выполняется поиск, когда вы используете поиск строки запроса. Это неплохо! В некоторых случаях может потребоваться привести более широкое представление сети, поэтому говорите.

Например, можно выполнить поиск по запросу "заметки о собраниях", используя метод управляемого API [ExchangeService. FindItems](https://msdn.microsoft.com/library/jj223808%28v=exchg.80%29.aspx) EWS.

```cs
FindItemsResults<Item> results = service.FindItems(folder, "meeting notes", view);
```

Если сравнить результаты этого поиска с результатами предыдущего примера поиска **SearchFilter. контаинссубстринг** , этот поиск будет содержать больше результатов. Поиск фильтра поиска будет возвращать только те элементы, которые содержат слово "заметки о собраниях" в теме, тогда как поиск будет возвращать элементы с "заметками о собраниях" в полях тема, текст и другие.

Давайте рассмотрим, как можно уточнить строку запроса, чтобы ближе понять результаты, которые вы видите в фильтре поиска. С помощью AQS можно ограничить поиск темой.

```cs
FindItemsResults<Item> results = service.FindItems(folder, "subject:meeting notes", view);
```

Это ближе, но результаты по-прежнему не совсем одинаковы. Если вы используете строку запроса с несколькими словами, вы получите совпадения даже в том случае, если слова не указаны в указанном порядке или даже если они не являются смежными друг с другом. С помощью строки запроса "Subject: заметки к собранию" вы получите совпадения для "заметок о собраниях", "заметки на собрании" и т. д. Для дальнейшего уточнения можно заключить условия поиска в двойные кавычки, чтобы указать, что вы хотите использовать только эту фразу.

```cs
FindItemsResults<Item> results = service.FindItems(folder, "subject:\"meeting notes\"", view);
```

## <a name="requesting-specific-properties-in-search-results"></a>Запрос определенных свойств в результатах поиска
<a name="bk_RequestSpecific"> </a>

По умолчанию результаты поиска будут содержать все свойства элементов, которые отвечают за поиск. В некоторых случаях это может потребоваться, но в большинстве случаев для приложения требуется только дискретный набор свойств. В этом случае следует ограничить набор свойств, возвращаемых только свойствами, которые требуются приложению. В следующем примере класс [итемвиев](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.itemview%28v=exchg.80%29.aspx) используется, чтобы ограничить возвращаемые свойства темой, датой и временем получения, а также идентификатором элементов.

```cs
ItemView view = new ItemView(10);
// Creating a new PropertySet with this constructor includes
// ItemSchema.Id.
view.PropertySet = new PropertySet(ItemSchema.Subject, ItemSchema.DateTimeReceived);
```

## <a name="controlling-search-depth"></a>Управление глубиной поиска
<a name="bk_SearchDepth"> </a>

Настройка обзора для представления позволяет управлять глубиной и областью поиска.

**Таблица 2. Значения обхода поиска**

|**Значение обхода**|**Относится к**|**Описание**|
|:-----|:-----|:-----|
|Поверхност  <br/> |Элементы и папки  <br/> |Неполные операции поиска ограничиваются прямыми потомками папки, в которой выполняется поиск.  <br/> |
|Углублен  <br/> |Элементы (только с папками поиска) и папками  <br/> |При глубоком поиске выполняется рекурсивный поиск в папке, в которой выполняется поиск, и вложенные папки.  <br/> |
|Соответствующую  <br/> |Элементы  <br/> |Связанные операции поиска включают только связанные элементы из папки, в которой выполняется поиск. Связанные элементы — это скрытые элементы в папке.  <br/> |
|SoftDeleted  <br/> |Элементы и папки  <br/> |Этот тип обхода устарел. Поиск в SoftDeleted включает только элементы, которые находятся в корзине. Корзина заменена [папкой "элементы с возможностью восстановления](https://docs.microsoft.com/exchange/policy-and-compliance/recoverable-items-folder/recoverable-items-folder) " в Exchange Online, Exchange Online в составе Office 365 и версиями Exchange, начиная с Exchange 2010.  <br/> |

## <a name="managing-search-results"></a>Управление результатами поиска
<a name="bk_ManageSearchResults"> </a>

Управляемый API EWS и EWS также позволяют изменять способ возврата результатов поиска. С помощью представлений можно указать, какие свойства включены в результаты, сортировать результаты и получать результаты, чтобы получить только заданное число результатов для каждого ответа. Вы также можете группировать результаты по определенным значениям полей и контролировать глубину поиска, указав тип обхода. Наконец, вы можете использовать папки поиска для создания постоянных поисков, которые обновляются динамически по мере поступления новых элементов.

### <a name="sorting"></a>сортировке;

Сервер может вернуть отсортированные результаты, что может упростить отображение и обработку элементов по порядку. В этом примере результаты сортируются по дате и времени получения, последние элементы — первыми.

```cs
view.OrderBy.Add(ItemSchema.DateTimeReceived, SortDirection.Descending);
```

### <a name="paging"></a>Разбиение на страницы

При отправке запроса на поиск с помощью управляемого API EWS или EWS вы указываете размер представления, который контролирует максимальное количество возвращаемых элементов. Однако количество элементов на сервере, которые совпадают с поиском, может быть больше размера представления. В этом случае сервер указывает, что доступны дополнительные элементы. Можно [использовать разбиение по страницам для повторения поиска](how-to-perform-paged-searches-by-using-ews-in-exchange.md) и получения следующего набора результатов.

Например, вы можете отправить запрос поиска с размером 10. На сервере может быть 15 элементов, которые отвечают за поиск, но вы получите только первые 10, а также индикатор ( [финдитемсресултс \<TItem\> . Свойство Мореаваилабле](https://msdn.microsoft.com/library/dd635477%28v=exchg.80%29.aspx) , если вы используете управляемый API EWS, на сервере больше результатов. Затем вы можете отправить такой же поиск со смещением, равным 10, чтобы запросить следующие 10 элементов, которые отвечают за поисковый запрос. Сервер возвратит оставшиеся пять элементов.

**Рис. 1. Пример страничного поиска**

![Иллюстрация, демонстрирующая страничный поиск. Первоначальный запрос отправляется на 10 элементов. Второй запрос отправляется для следующих 10 элементов.](media/Ex15_Search_PagedSearch.png)

### <a name="grouping"></a>Группирование

 Exchange позволяет группировать результаты поиска по определенному полю. Это помогает разбивать результаты поиска на более управляемые наборы. Например, можно выполнить поиск по запросу "заметки собрания" и сгруппировать результаты по отправителю. Как показано на следующем рисунке, возвращенные элементы будут разделяться на группы со всеми элементами, которые соответствуют условиям того же отправителя в одной группе, всем соответствующим элементам от другого отправителя в другой группе и т. д.

**Рис. 2. Результаты поиска, сгруппированные по отправителю**

![Изображение результатов поиска, сгруппированных по отправителям.](media/Ex15_Search_GroupedResults.png)

## <a name="search-folders"></a>Папки поиска
<a name="bk_SearchFolders"> </a>

При обычном поиске выполняется поиск, результаты возвращаются в приложение для обработки, а поиск прекращается. Папки поиска позволяют выполнять поиск в сохраняемом виде. Это отличный вариант для поиска, который вы будете использовать несколько раз. Вместо того чтобы многократно выполнять один и тот же поиск, в результате чего сервер будет оценивать Поиск с нуля каждый раз, папка поиска делает поиск всегда включенным, позволяя серверу обновлять существующий результирующий набор при добавлении или удалении элементов в области поиска. Папки поиска действуют как обычные папки, в которых они отображаются как папки с элементами в них. Различие состоит в том, что в папке находятся только те элементы, которые соответствуют критериям поиска, связанным с папкой. После создания папки поиска приложение может получить актуальные результаты поиска, только проверив содержимое папки.

Создание папки поиска является простой при создании фильтров поиска. В следующем примере создается папка поиска для отображения всех сообщений электронной почты с темой, содержащей "заметки о собраниях".

```cs
static void CreateSearchFolder(ExchangeService service)
{
    SearchFilter.ContainsSubstring subjectFilter = new SearchFilter.ContainsSubstring(ItemSchema.Subject,
        "meeting notes", ContainmentMode.Substring, ComparisonMode.IgnoreCase);
    SearchFolder searchFolder = new SearchFolder(service);
    searchFolder.DisplayName = "Meeting Notes";
    searchFolder.SearchParameters.RootFolderIds.Add(WellKnownFolderName.Inbox);
    searchFolder.SearchParameters.Traversal = SearchFolderTraversal.Deep;
    searchFolder.SearchParameters.SearchFilter = subjectFilter;
    searchFolder.Save(WellKnownFolderName.SearchFolders);
}
```

## <a name="in-this-section"></a>В этой статье
<a name="bk_InThisSection"> </a>

- [Использование фильтров поиска с EWS в Exchange](how-to-use-search-filters-with-ews-in-exchange.md)

- [Выполнение поиска AQS с помощью EWS в Exchange](how-to-perform-an-aqs-search-by-using-ews-in-exchange.md)

- [Выполнение постраничного поиска с помощью EWS в Exchange](how-to-perform-paged-searches-by-using-ews-in-exchange.md)

- [Выполнение группового поиска с помощью EWS в Exchange](how-to-perform-grouped-searches-by-using-ews-in-exchange.md)

- [Работайте с папками поиска с помощью EWS в Exchange](how-to-work-with-search-folders-by-using-ews-in-exchange.md)

## <a name="see-also"></a>См. также


- [Разработка клиентов веб-служб для Exchange](develop-web-service-clients-for-exchange.md)

- [Папка "элементы с возможностью восстановления"](https://docs.microsoft.com/exchange/policy-and-compliance/recoverable-items-folder/recoverable-items-folder)

- [ExchangeService.FindItems](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.exchangeservice.finditems%28v=exchg.80%29.aspx)

- [Параметры политики регулирования, которые влияют на поисковые операции EWS](ews-throttling-in-exchange.md#throttling-policy-parameters-that-affect-ews-search-operations)
