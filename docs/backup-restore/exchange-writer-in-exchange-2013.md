---
title: Модуль записи Exchange в Exchange 2013
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
ms.prod: office-online-server
localization_priority: Normal
ms.assetid: ec126433-9f0a-46ec-a685-ff4af2f97bc1
description: Сведения о записи Exchange в Exchange 2013 для резервного копирования и восстановления.
ms.openlocfilehash: a4dc5963ab24a83969efc6e425b38a35276f3aa3
ms.sourcegitcommit: 34041125dc8c5f993b21cebfc4f8b72f0fd2cb6f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/25/2018
ms.locfileid: "19760916"
---
# <a name="exchange-writer-in-exchange-2013"></a><span data-ttu-id="500e0-103">Модуль записи Exchange в Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="500e0-103">Exchange writer in Exchange 2013</span></span>

<span data-ttu-id="500e0-104">Сведения о записи Exchange в Exchange 2013 для резервного копирования и восстановления.</span><span class="sxs-lookup"><span data-stu-id="500e0-104">Find information about the Exchange writer in Exchange 2013 for backup and restore operations.</span></span> 
  
<span data-ttu-id="500e0-105">**Применимо к:** Exchange Server 2013</span><span class="sxs-lookup"><span data-stu-id="500e0-105">**Applies to:** Exchange Server 2013</span></span> 
  
<span data-ttu-id="500e0-106">Модуль записи Exchange несет ответственность за резервное копирование и восстановление из активных баз данных Exchange Server 2013.</span><span class="sxs-lookup"><span data-stu-id="500e0-106">The Exchange writer is responsible for the backup and restore of active Exchange Server 2013 databases.</span></span> <span data-ttu-id="500e0-107">Записи Exchange также поддерживает функции архивации для выбранной базы данных, где теневая копия берется с экземпляром реплицированной базы данных и транзакций файлов журнала.</span><span class="sxs-lookup"><span data-stu-id="500e0-107">The Exchange writer also supports backup functionality for a selected database where the shadow copy is taken against the replicated instance of the database and transaction log files.</span></span> 
  
## <a name="overview-of-the-exchange-writer"></a><span data-ttu-id="500e0-108">Общие сведения о записи Exchange</span><span class="sxs-lookup"><span data-stu-id="500e0-108">Overview of the Exchange writer</span></span>
<span data-ttu-id="500e0-109"><a name="bk_Overview"> </a></span><span class="sxs-lookup"><span data-stu-id="500e0-109"></span></span>

<span data-ttu-id="500e0-110">Exchange 2013 включает в себя функции мобильности базы данных, позволяющие баз данных для репликации между серверами разных Exchange для повышения доступности базы данных и устойчивости сайтов.</span><span class="sxs-lookup"><span data-stu-id="500e0-110">Exchange 2013 includes database mobility features, which enable databases to be replicated among different Exchange servers to improve database availability and site resilience.</span></span> <span data-ttu-id="500e0-111">Другие копии базы данных в группе доступности базы данных (DAG) предоставляют ценную возможность для процессов резервного копирования Exchange использовать дополнительные ресурсы, доступные в расположении копии.</span><span class="sxs-lookup"><span data-stu-id="500e0-111">The other database copies in a Database Availability Group (DAG) provide a valuable opportunity for Exchange backups to use the extra resources that are available at the copy location.</span></span> <span data-ttu-id="500e0-112">Кроме того так как создается резервная копия вместо хозяином активной базы данных копии могут быть недоступны во время резервного копирования на длительный период времени.</span><span class="sxs-lookup"><span data-stu-id="500e0-112">In addition, because the copy instead of the active database master is backed up, the copy can be unavailable during the backup for a longer period of time.</span></span> 
  
<span data-ttu-id="500e0-113">Модуль записи Exchange поддерживает служб Exchange (эксплуатация от имени инициатор запроса) для подготовки файлов базы данных для резервного копирования, заморозить для ввода/ВЫВОДА для действия, связанные с Exchange операций перед резервного копирования базы данных и освободить и усекать файлы журналов после завершения резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="500e0-113">The Exchange writer coordinates with the Exchange services (operating on behalf of the requester) to prepare the database files for backups, freeze the IO activity resulting from Exchange transactions before backing up the database, and then unfreeze and truncate log files after the backup is complete.</span></span>
  
<span data-ttu-id="500e0-114">Во время восстановления резервное копирование и восстановление приложения, этот параметр модуля записи Exchange для координации с хранилищем Exchange (эксплуатация от имени инициатор запроса) для проверки целей восстановления, переименуйте файл базы данных при необходимости и затем повторить процесс журналы при необходимости.</span><span class="sxs-lookup"><span data-stu-id="500e0-114">During a restore, your backup and restore application instructs the Exchange writer to coordinate with the Exchange store (operating on behalf of the requester) to verify the restore targets, rename the database file if necessary, and then replay the transaction logs as needed.</span></span> <span data-ttu-id="500e0-115">Модуль записи Exchange поддерживает резервное копирование и восстановление.</span><span class="sxs-lookup"><span data-stu-id="500e0-115">The Exchange writer supports both backups and restores.</span></span>
  
<span data-ttu-id="500e0-116">Модуль записи Exchange доступна на любом сервере Exchange, с установленной ролью сервера почтовых ящиков.</span><span class="sxs-lookup"><span data-stu-id="500e0-116">The Exchange writer is available on any Exchange server that has the Mailbox server role installed.</span></span> 
  
## <a name="exchange-writer-configuration-settings"></a><span data-ttu-id="500e0-117">Параметры конфигурации модуля записи Exchange</span><span class="sxs-lookup"><span data-stu-id="500e0-117">Exchange writer configuration settings</span></span>
<span data-ttu-id="500e0-118"><a name="bk_ExchangeWriterConfig"> </a></span><span class="sxs-lookup"><span data-stu-id="500e0-118"></span></span>

<span data-ttu-id="500e0-119">Модуль записи Exchange для VSS использует различные параметры и значения, которые необходимо правильно настроить и сохраняется во время операции резервного копирования и восстановления.</span><span class="sxs-lookup"><span data-stu-id="500e0-119">The Exchange writer for VSS uses a variety of settings and values that must be set correctly and preserved during backup and restore operations.</span></span> <span data-ttu-id="500e0-120">Эти параметры конфигурации хранятся в документ метаданных модуля записи Exchange.</span><span class="sxs-lookup"><span data-stu-id="500e0-120">These configuration settings are stored in the Exchange writer metadata document.</span></span> <span data-ttu-id="500e0-121">Если ваше приложение резервного копирования не сохраняет эти параметры, могут возникнуть непредвиденные ошибки при попытке выполнить резервное копирование баз данных Exchange.</span><span class="sxs-lookup"><span data-stu-id="500e0-121">If your backup application does not preserve these settings, you might experience unexpected errors when you attempt to back up your Exchange databases.</span></span> 
  
<span data-ttu-id="500e0-122">В следующей таблице перечислены интерфейсы VSS, метаданные о компонентах резервного копирования базы данных.</span><span class="sxs-lookup"><span data-stu-id="500e0-122">The following table lists the VSS interfaces that expose metadata about the components of your database backup.</span></span> <span data-ttu-id="500e0-123">Эти интерфейсы необходимы для получения модуля записи Exchange документа метаданных, который используется для выполнения резервного копирования в хранилище Exchange.</span><span class="sxs-lookup"><span data-stu-id="500e0-123">These interfaces are required to get the Exchange writer metadata document that is used to perform a backup of the Exchange store.</span></span>
  
<span data-ttu-id="500e0-124">**В таблице 1. Служба теневого копирования ТОМОВ интерфейсов**</span><span class="sxs-lookup"><span data-stu-id="500e0-124">**Table 1. VSS interfaces**</span></span>

|<span data-ttu-id="500e0-125">**Интерфейс служба теневого копирования ТОМОВ**</span><span class="sxs-lookup"><span data-stu-id="500e0-125">**VSS interface**</span></span>|<span data-ttu-id="500e0-126">**Описание**</span><span class="sxs-lookup"><span data-stu-id="500e0-126">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="500e0-127">IVssWMComponent</span><span class="sxs-lookup"><span data-stu-id="500e0-127">IVssWMComponent</span></span>  <br/> |<span data-ttu-id="500e0-128">Разрешает доступ компонент информацию, содержащуюся в модуля записи Exchange.</span><span class="sxs-lookup"><span data-stu-id="500e0-128">Allows access to component information stored in the Exchange writer.</span></span>  <br/> |
|<span data-ttu-id="500e0-129">IVssExamineWriterMetadata</span><span class="sxs-lookup"><span data-stu-id="500e0-129">IVssExamineWriterMetadata</span></span>  <br/> |<span data-ttu-id="500e0-130">Разрешает запрашивающее приложение резервного копирования и восстановления для просмотра метаданных модуля записи Exchange.</span><span class="sxs-lookup"><span data-stu-id="500e0-130">Allows the requesting backup and restore application to examine the metadata of the Exchange writer.</span></span> <span data-ttu-id="500e0-131">Документ метаданных модуля записи Exchange содержит значений, зависимых от Exchange 2013 и параметры, запрашивающее приложение резервного копирования и восстановления требует, чтобы он правильно можно указать необходимые компоненты для резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="500e0-131">The Exchange writer metadata document contains Exchange 2013-specific values and parameters that the requesting backup and restore application requires so that it can correctly specify the appropriate components for backup.</span></span>  <br/> |
|<span data-ttu-id="500e0-132">IVssComponent</span><span class="sxs-lookup"><span data-stu-id="500e0-132">IVssComponent</span></span>  <br/> |<span data-ttu-id="500e0-133">Содержит методы для изучения и изменения данных о компонентах в документах компоненты инициатора резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="500e0-133">Contains methods for examining and modifying information about components contained in a requester's Backup Components Document.</span></span> <span data-ttu-id="500e0-134">Объекты можно получить только для тех компонентов, которые были явно добавлены в этом документе с помощью метода [IVssBackupComponents::AddComponent](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa382646%28v=vs.85%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="500e0-134">Objects can only be obtained for those components that have been explicitly added to this document by the [IVssBackupComponents::AddComponent](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa382646%28v=vs.85%29.aspx) method.</span></span>  <br/> |
|<span data-ttu-id="500e0-135">IVssBackupComponents</span><span class="sxs-lookup"><span data-stu-id="500e0-135">IVssBackupComponents</span></span>  <br/> |<span data-ttu-id="500e0-136">Используется запрашивающее приложение резервного копирования и восстановления для опроса модуля записи Exchange о состоянии файла и для выполнения резервного копирования и восстановления.</span><span class="sxs-lookup"><span data-stu-id="500e0-136">Used by the requesting backup and restore application to poll the Exchange writer about file status and to run backup and restore operations.</span></span> <span data-ttu-id="500e0-137">Метод [IVssBackupComponents::SetBackupState](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa382833%28v=vs.85%29.aspx) определяет, является ли операция резервного копирования полное, копия, добавочный, или разностного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="500e0-137">The [IVssBackupComponents::SetBackupState ](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa382833%28v=vs.85%29.aspx) method defines whether the backup operation is a full, copy, incremental, or differential backup.</span></span> <span data-ttu-id="500e0-138">Метод [IVssBackupComponents::AddRestoreSubcomponent](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa382649%28v=vs.85%29.aspx) определяет подкомпоненты в Exchange 2013 базы данных, можно выбрать для операции восстановления.</span><span class="sxs-lookup"><span data-stu-id="500e0-138">The [IVssBackupComponents::AddRestoreSubcomponent](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa382649%28v=vs.85%29.aspx) method defines the subcomponents of an Exchange 2013 database that can be selected for a restore operation.</span></span>  <br/> |
   
<span data-ttu-id="500e0-139">В файловой системе Windows Server базы данных Exchange 2013 сохраняется как файл одну базу данных с расширением *.edb. Предоставляет модуля записи Exchange *.edb как компонент базы данных и журналов транзакций (*.log) и файлы контрольной точки (*.chk) объединяются в один компонент, называется компонент журнала.</span><span class="sxs-lookup"><span data-stu-id="500e0-139">Within the Windows Server file system, an Exchange 2013 database is stored as a single database file with an extension *.edb. The Exchange writer exposes the *.edb as the database component, while transaction logs (*.log) and checkpoint files (*.chk) are combined into a single component, referred to as the log component.</span></span> <span data-ttu-id="500e0-140">Дополнительные сведения о файлах базы данных Exchange в разделе [Основные понятия резервного копирования и восстановления для Exchange 2013](backup-and-restore-concepts-for-exchange-2013.md).</span><span class="sxs-lookup"><span data-stu-id="500e0-140">For more information about Exchange database files, see [Backup and restore concepts for Exchange 2013](backup-and-restore-concepts-for-exchange-2013.md).</span></span>
  
## <a name="interactions-between-the-exchange-writer-vss-and-vss-requesters"></a><span data-ttu-id="500e0-141">Взаимодействие между модуля записи Exchange, служба теневого копирования ТОМОВ и служба теневого копирования ТОМОВ инициатор запроса</span><span class="sxs-lookup"><span data-stu-id="500e0-141">Interactions between the Exchange writer, VSS, and VSS requesters</span></span>
<span data-ttu-id="500e0-142"><a name="bk_interactions"> </a></span><span class="sxs-lookup"><span data-stu-id="500e0-142"></span></span>

<span data-ttu-id="500e0-143">Высокоуровневая взаимодействие между VSS, модуля записи Exchange и Exchange 2013 во время операции резервного копирования выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="500e0-143">The high-level interaction between the VSS, the Exchange writer, and Exchange 2013 during backup operations is as follows:</span></span>
  
1. <span data-ttu-id="500e0-144">Резервной копии программы (или агент) запускает запланированное задание.</span><span class="sxs-lookup"><span data-stu-id="500e0-144">The backup program (or agent) runs a scheduled job.</span></span> 
    
2. <span data-ttu-id="500e0-145">Источник запроса служба теневого копирования ТОМОВ в приложении резервное копирование и восстановление отправляет команду служба теневого копирования ТОМОВ на создание теневой копии выбранных баз данных Exchange 2013.</span><span class="sxs-lookup"><span data-stu-id="500e0-145">The VSS requester in the backup and restore application sends a command to VSS to take a shadow copy of the selected Exchange 2013 databases.</span></span> 
    
3. <span data-ttu-id="500e0-146">Служба теневого копирования ТОМОВ взаимодействует с помощью модуля записи Exchange для подготовки к резервной копии моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="500e0-146">VSS communicates with the Exchange writer to prepare for a snapshot backup.</span></span> <span data-ttu-id="500e0-147">Exchange 2013 запрещает административных действий для баз данных, проверяет зависимости тома и приостанавливает все операции записи для выбранного экземпляра базы данных и файлы журнала транзакций и разрешить доступ только для чтения.</span><span class="sxs-lookup"><span data-stu-id="500e0-147">Exchange 2013 prohibits administrative actions against the databases, checks volume dependencies, and suspends all write operations to selected instance of the database and transaction log files while allowing read-only access.</span></span> 
    
4. <span data-ttu-id="500e0-148">Служба теневого копирования ТОМОВ взаимодействует с соответствующим поставщиком хранилища, чтобы создать теневую копию тома хранилища, содержащего баз данных Exchange 2013.</span><span class="sxs-lookup"><span data-stu-id="500e0-148">VSS communicates with the appropriate storage provider to create a shadow copy of the storage volume that contains the Exchange 2013 databases.</span></span> 
    
5. <span data-ttu-id="500e0-149">Служба теневого копирования ТОМОВ освобождает Exchange 2013 для возобновления стандартных операций.</span><span class="sxs-lookup"><span data-stu-id="500e0-149">VSS releases Exchange 2013 to resume ordinary operations.</span></span> 
    
6. <span data-ttu-id="500e0-150">Источник запроса VSS проверяет физической согласованности резервного набора данных перед сигналы успешности завершения резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="500e0-150">The VSS requester verifies the physical consistency of the backup set prior to signaling that the backup was successful.</span></span> <span data-ttu-id="500e0-151">Exchange 2013 длинного журналы транзакций (если база данных является частью группы DAG, усечение журнала является реплицируются все копии) и регистрирует время последнего резервного копирования базы данных.</span><span class="sxs-lookup"><span data-stu-id="500e0-151">Exchange 2013 truncates the transaction logs (if the database is part of a DAG, log truncation is replicated among all the copies) and records the time of the last backup for the database.</span></span>
    
<span data-ttu-id="500e0-152">Служба теневого копирования ТОМОВ сериализации инициатор запроса взаимодействие с помощью модуля записи Exchange, начиная с помощью метода [OnPrepareBackup](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa381571%28v=vs.85%29.aspx) и метод [OnPostSnapshot](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa381568%28v=vs.85%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="500e0-152">VSS serializes requesters' interaction with the Exchange writer starting with the [OnPrepareBackup](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa381571%28v=vs.85%29.aspx) method and ending with the [OnPostSnapshot](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa381568%28v=vs.85%29.aspx) method.</span></span> <span data-ttu-id="500e0-153">Как правило большую часть времени модуля записи Exchange тратит, работая с теневой копии происходит после метода **OnPostSnapshot** , когда проверки согласованности теневой копии до завершения резервных копий.</span><span class="sxs-lookup"><span data-stu-id="500e0-153">Typically, the majority of time the Exchange writer spends working with the shadow copy occurs after the **OnPostSnapshot** method, when the consistency of the shadow copy is verified prior to completion of the backups.</span></span> <span data-ttu-id="500e0-154">Модуль записи Exchange поддерживает параллельных резервных копий между **OnPostSnapshot** и [OnBackupComplete](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa381557%28v=vs.85%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="500e0-154">The Exchange writer supports parallel backups between **OnPostSnapshot** and [OnBackupComplete](http://msdn.microsoft.com/ru-ru/library/windows/desktop/aa381557%28v=vs.85%29.aspx).</span></span>
  
<span data-ttu-id="500e0-155">Exchange 2013 не разрешает параллельных резервных копий той же базе данных.</span><span class="sxs-lookup"><span data-stu-id="500e0-155">Exchange 2013 does not allow concurrent backups of the same database.</span></span> <span data-ttu-id="500e0-156">Только один задания резервного копирования может выполняться для этой базы данных за один раз.</span><span class="sxs-lookup"><span data-stu-id="500e0-156">Only one backup job can run against a given database at one time.</span></span> <span data-ttu-id="500e0-157">При выполнении резервного копирования, в хранилище Exchange переводит базу данных в резервной копии в процессе выполнения.</span><span class="sxs-lookup"><span data-stu-id="500e0-157">When the backup is running, the Exchange store puts the database in a backup-in-progress state.</span></span> <span data-ttu-id="500e0-158">Это состояние в памяти снят, либо по завершении резервного копирования или при запуске службы.</span><span class="sxs-lookup"><span data-stu-id="500e0-158">This in-memory state is cleared either at the completion of the backup process or when the service is restarted.</span></span> <span data-ttu-id="500e0-159">Состояние резервное копирование выполняется в памяти и связанные с ним данные не сохраняются при перезапуске службы, на котором размещается модуля записи Exchange, после перезапуска операционной системы или в случае сбоя кластера.</span><span class="sxs-lookup"><span data-stu-id="500e0-159">The in-memory backup-in-progress state and its associated data are lost when the service that hosts the Exchange writer is restarted, when the operating system is restarted, or when a cluster failover occurs.</span></span> <span data-ttu-id="500e0-160">Любое из этих событий будет отображено задание резервного копирования для отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="500e0-160">Any of these events will cause the backup job to fail.</span></span>
  
<span data-ttu-id="500e0-161">Усечение файла журнала транзакций, инициированных пользователем резервного копирования запускается на основе типа выполняемой резервной копии.</span><span class="sxs-lookup"><span data-stu-id="500e0-161">Backup-initiated transaction log file truncation is triggered based on the type of backup to be performed.</span></span> <span data-ttu-id="500e0-162">В конфигурациях без обеспечения доступности баз данных модуля записи Exchange будет удалять файлы журнала транзакций после завершения работы программы успешного полного или разностного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="500e0-162">In non-DAG configurations, the Exchange writer will truncate the transaction log files at the completion of successful full or incremental backups.</span></span> <span data-ttu-id="500e0-163">В группы доступности базы данных репликации конфигураций, усечение журнала будет отложено службой репликации, пока все необходимые файлы записываются в других копий.</span><span class="sxs-lookup"><span data-stu-id="500e0-163">In DAG replicated configurations, log truncation will be delayed by the replication service until all necessary log files are replayed into all other copies.</span></span> <span data-ttu-id="500e0-164">Служба репликации приведет к удалению резервной копии файлов журнала, как из активного и эту копию пути к файлам журнала после проверяется, что файлы журнала успешно применена к копию базы данных и оба активной базы данных и истекло контрольной точки копий базы данных файлы журналов для удаления.</span><span class="sxs-lookup"><span data-stu-id="500e0-164">The replication service will delete the backed up log files both from the active and the copy log file paths after it verifies that the log files have successfully been applied to the copy database and both active database and the database copies checkpoint has passed the log files to be deleted.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="500e0-165">См. также</span><span class="sxs-lookup"><span data-stu-id="500e0-165">See also</span></span>

- [<span data-ttu-id="500e0-166">Журналы транзакций и файлов контрольной точки для резервного копирования и восстановления в Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="500e0-166">Transaction logs and checkpoint files for backup and restore in Exchange 2013</span></span>](transaction-logs-and-checkpoint-files-for-backup-and-restore-in-exchange.md)
    
- [<span data-ttu-id="500e0-167">Основные понятия резервного копирования и восстановления для Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="500e0-167">Backup and restore concepts for Exchange 2013</span></span>](backup-and-restore-concepts-for-exchange-2013.md)
    

