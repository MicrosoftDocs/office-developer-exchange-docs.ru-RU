---
title: Оборудование клиентских запросов для веб-служб Exchange и REST в Exchange
manager: sethgros
ms.date: 4/13/2016
ms.audience: Developer
localization_priority: Normal
ms.assetid: 330de503-498d-447e-b4a9-c20fc1699fd1
description: Сведения о заголовках HTTP в веб-служб Exchange и REST запросы и ответы, которые помогут вам мониторинг и устранение неполадок Exchange приложения.
ms.openlocfilehash: bcf362952c29956729c44397043a56bf3603d0af
ms.sourcegitcommit: 34041125dc8c5f993b21cebfc4f8b72f0fd2cb6f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19761142"
---
# <a name="instrumenting-client-requests-for-ews-and-rest-in-exchange"></a><span data-ttu-id="7c4ce-103">Оборудование клиентских запросов для веб-служб Exchange и REST в Exchange</span><span class="sxs-lookup"><span data-stu-id="7c4ce-103">Instrumenting client requests for EWS and REST in Exchange</span></span>

<span data-ttu-id="7c4ce-104">Сведения о заголовках HTTP в веб-служб Exchange и REST запросы и ответы, которые помогут вам мониторинг и устранение неполадок Exchange приложения.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-104">Learn about the HTTP headers in EWS and REST requests and responses that can help you monitor and troubleshoot your Exchange application.</span></span>
  
<span data-ttu-id="7c4ce-105">Это никогда не произошло вам?</span><span class="sxs-lookup"><span data-stu-id="7c4ce-105">Has this ever happened to you?</span></span> <span data-ttu-id="7c4ce-106">Пользователь приложения отчетов произошла непредвиденная ошибка.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-106">A user of your application reports an unexpected error.</span></span> <span data-ttu-id="7c4ce-107">Необходимо рассмотреть, но не удается воспроизвести его.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-107">You want to investigate, but you can't reproduce it.</span></span> <span data-ttu-id="7c4ce-108">Ошибка исчезла для пользователя, и вы получили очень маленьким другие необходимые сведения.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-108">The error has disappeared for the user, and you're left with very little actionable data.</span></span> <span data-ttu-id="7c4ce-109">Раздражающим, правда?</span><span class="sxs-lookup"><span data-stu-id="7c4ce-109">Frustrating, isn't it?</span></span> <span data-ttu-id="7c4ce-110">Давайте рассмотрим, как заранее подготовить для этого сценария и надеюсь избежать проблему в будущем.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-110">Let's look at how you can proactively prepare for this scenario and hopefully avoid frustration in the future.</span></span>
  
## <a name="add-instrumentation-to-requests"></a><span data-ttu-id="7c4ce-111">Добавление инструментирования для запросов</span><span class="sxs-lookup"><span data-stu-id="7c4ce-111">Add instrumentation to requests</span></span>

<span data-ttu-id="7c4ce-112">Рекомендуется добавлять дополнительные заголовки HTTP для ваших запросов для облегчения устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-112">We recommend that you add additional HTTP headers to your requests to facilitate troubleshooting.</span></span> <span data-ttu-id="7c4ce-113">Следует вести запись эти сведения, где-нибудь (например, в файл журнала), чтобы его можно получить более поздней версии, если необходимо.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-113">You should keep a record of this information somewhere (for example, in a log file) so that you can retrieve it later if you need to.</span></span> <span data-ttu-id="7c4ce-114">Функция полезна, если анализ сетевого трафика, а также полезна, если вы обратиться в службу поддержки корпорации Майкрософт для получения помощи.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-114">This is helpful when examining network traffic, and is also helpful if you contact Microsoft support for assistance.</span></span>
  
<span data-ttu-id="7c4ce-115">**В таблице 1. Заголовки запроса для устранения неполадок**</span><span class="sxs-lookup"><span data-stu-id="7c4ce-115">**Table 1. Request headers for troubleshooting**</span></span>

|<span data-ttu-id="7c4ce-116">**Заголовок HTTP (EWS)**</span><span class="sxs-lookup"><span data-stu-id="7c4ce-116">**HTTP header (EWS)**</span></span>|<span data-ttu-id="7c4ce-117">**Управляемый API EWS эквивалент**</span><span class="sxs-lookup"><span data-stu-id="7c4ce-117">**EWS Managed API equivalent**</span></span>|<span data-ttu-id="7c4ce-118">**Примечания**</span><span class="sxs-lookup"><span data-stu-id="7c4ce-118">**Notes**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="7c4ce-119">Агент пользователя</span><span class="sxs-lookup"><span data-stu-id="7c4ce-119">User-Agent</span></span>  <br/> |[<span data-ttu-id="7c4ce-120">ExchangeService.UserAgent</span><span class="sxs-lookup"><span data-stu-id="7c4ce-120">ExchangeService.UserAgent</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.useragent%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="7c4ce-121">Значение уникальное значение, определяющее клиентского приложения.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-121">Set this to a unique value that identifies your client application.</span></span><br/><br/> <span data-ttu-id="7c4ce-122">Для всех запросов, которые приложение отправляет позволяет корпорации Майкрософт в устранении сбоями вызовов с использованием такого же значения, следует их возникновения.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-122">Using the same value for all requests that your application sends allows Microsoft to help troubleshoot call failures, should they arise.</span></span>  <br/> |
|<span data-ttu-id="7c4ce-123">код запроса клиента</span><span class="sxs-lookup"><span data-stu-id="7c4ce-123">client-request-id</span></span>  <br/> |[<span data-ttu-id="7c4ce-124">ExchangeService.ClientRequestId</span><span class="sxs-lookup"><span data-stu-id="7c4ce-124">ExchangeService.ClientRequestId</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.clientrequestid%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="7c4ce-125">Значение разных уникальное значение приложение отправляет запрос.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-125">Set this to a different unique value for every request your application sends.</span></span><br/><br/> <span data-ttu-id="7c4ce-126">Мы рекомендуем использовать GUID.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-126">We recommend that you use a GUID.</span></span> <span data-ttu-id="7c4ce-127">Этот уникальный идентификатор предназначен для использования для соотнесения мероприятий между двумя системами в случае, если возникновения непредвиденных обстоятельств.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-127">This unique identifier is intended to be used to correlate activities between two systems in the event that something goes wrong.</span></span>  <br/> |
|<span data-ttu-id="7c4ce-128">Return-client--код запроса</span><span class="sxs-lookup"><span data-stu-id="7c4ce-128">return-client-request-id</span></span>  <br/> |[<span data-ttu-id="7c4ce-129">ExchangeService.ReturnClientRequestId</span><span class="sxs-lookup"><span data-stu-id="7c4ce-129">ExchangeService.ReturnClientRequestId</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.returnclientrequestid%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="7c4ce-130">Задайте **значение true** для оповещения на сервере Exchange, что он должен возвращать значение запрос идентификатором клиента в соответствующем ответ.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-130">Set this to **true** to signal to the Exchange server that it should return the value of your client-request-id in the corresponding response.</span></span><br/><br/> <span data-ttu-id="7c4ce-131">Это можно использовать для соотнесения запросов и ответов в трассировку сети или трассировки управляемый API веб-служб Exchange.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-131">You can use this to correlate requests and responses in network traces or EWS Managed API traces.</span></span>  <br/> |
|<span data-ttu-id="7c4ce-132">X-ClientStatistics</span><span class="sxs-lookup"><span data-stu-id="7c4ce-132">X-ClientStatistics</span></span>  <br/> |[<span data-ttu-id="7c4ce-133">ExchangeService.SendClientLatencies</span><span class="sxs-lookup"><span data-stu-id="7c4ce-133">ExchangeService.SendClientLatencies</span></span>](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) <br/> |<span data-ttu-id="7c4ce-134">Используется для [задержки EWS отчета](#bk_ReportLatency) в корпорацию Майкрософт, если приложение является доступа к Exchange Online или Exchange Online в составе Office 365.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-134">Used to [report EWS latencies](#bk_ReportLatency) to Microsoft if your application is accessing Exchange Online or Exchange Online as part of Office 365.</span></span>  <br/> |
   
## <a name="log-information-from-responses"></a><span data-ttu-id="7c4ce-135">Сведения журнала из ответов на отчеты</span><span class="sxs-lookup"><span data-stu-id="7c4ce-135">Log information from responses</span></span>

<span data-ttu-id="7c4ce-136">Так же, как вашего клиента можно добавить дополнительные инструментария запросы, отправляемые им, Exchange добавляет дополнительные инструментария ответы в формате заголовки HTTP.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-136">Just as your client can add additional instrumentation to the requests it sends, Exchange adds additional instrumentation to the responses in the form of HTTP headers.</span></span> <span data-ttu-id="7c4ce-137">Клиент должен сохранить эти сведения, чтобы перейти наряду со сведениями о инструментария запроса.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-137">Your client should capture this information to go along with the request instrumentation information.</span></span>
  
> [!NOTE]
> <span data-ttu-id="7c4ce-138">Если используется управляемый API EWS не имеет эквивалента прямое для заголовков HTTP.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-138">If you are using the EWS Managed API, there is no direct equivalent for the HTTP headers.</span></span> <span data-ttu-id="7c4ce-139">Тем не менее все заголовки HTTP-ответа осуществляется через свойство [ExchangeService.HttpResponseHeaders](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.httpresponseheaders%28v=exchg.80%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="7c4ce-139">However, all HTTP response headers can be accessed via the [ExchangeService.HttpResponseHeaders](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.httpresponseheaders%28v=exchg.80%29.aspx) property.</span></span> 
  
<span data-ttu-id="7c4ce-140">**В таблице 2. Заголовки HTTP-ответа**</span><span class="sxs-lookup"><span data-stu-id="7c4ce-140">**Table 2. HTTP response headers**</span></span>

|<span data-ttu-id="7c4ce-141">**Заголовок HTTP**</span><span class="sxs-lookup"><span data-stu-id="7c4ce-141">**HTTP header**</span></span>|<span data-ttu-id="7c4ce-142">**Описание**</span><span class="sxs-lookup"><span data-stu-id="7c4ce-142">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="7c4ce-143">код запроса</span><span class="sxs-lookup"><span data-stu-id="7c4ce-143">request-id</span></span>  <br/> |<span data-ttu-id="7c4ce-144">Созданные сервером код запроса, соответствующий этой ответа.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-144">A server-generated ID for the request that corresponds to this response.</span></span>  <br/> |
|<span data-ttu-id="7c4ce-145">код запроса клиента</span><span class="sxs-lookup"><span data-stu-id="7c4ce-145">client-request-id</span></span>  <br/> |<span data-ttu-id="7c4ce-146">Значение заголовка запроса идентификатор клиента в запросе.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-146">The value of the client-request-id header in the request.</span></span><br/><br/> <span data-ttu-id="7c4ce-147">В этом заголовке присутствует только в том случае, если запрос содержит заголовок return-client--код запроса, значение **true**.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-147">This header is only present if the request contains the return-client-request-id header with a value of **true**.</span></span>  <br/> |
|<span data-ttu-id="7c4ce-148">X-feserver.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-148">X-FEServer</span></span>  <br/> |<span data-ttu-id="7c4ce-149">Полное доменное имя сервера клиентского доступа, обработку запроса.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-149">The FQDN of the Client Access server that processed the request.</span></span>  <br/> |
|<span data-ttu-id="7c4ce-150">X-TargetBEServer</span><span class="sxs-lookup"><span data-stu-id="7c4ce-150">X-TargetBEServer</span></span>  <br/> |<span data-ttu-id="7c4ce-151">Полное доменное имя сервера почтовых ящиков, обработку запроса.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-151">The FQDN of the mailbox server that processed the request.</span></span>  <br/> |
|<span data-ttu-id="7c4ce-152">X-diaginfo.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-152">X-DiagInfo</span></span>  <br/> |<span data-ttu-id="7c4ce-153">Дополнительную информацию, в зависимости от запроса.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-153">Additional diagnostic information, depending on the request.</span></span>  <br/> |
|<span data-ttu-id="7c4ce-154">x-ms-diagnostics</span><span class="sxs-lookup"><span data-stu-id="7c4ce-154">x-ms-diagnostics</span></span>  <br/> | <span data-ttu-id="7c4ce-155">Этот заголовок применима только в том случае, если используется проверка подлинности OAuth в запросе.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-155">This header is only applicable if OAuth authentication is used in the request.</span></span><br/><br/> <span data-ttu-id="7c4ce-156">Он содержит код явные ошибки, которая указывает причины сбоя проверки подлинности OAuth.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-156">It contains an explicit error code that specifies why an OAuth authentication failed.</span></span><br/><br/> <span data-ttu-id="7c4ce-157">Она имеет следующий формат:`errorId;reason="reason"error_type="error type"`</span><span class="sxs-lookup"><span data-stu-id="7c4ce-157">It takes the following format: `errorId;reason="reason"error_type="error type"`</span></span><br/><br/> <span data-ttu-id="7c4ce-158">Поле **Причина** — это понятное описание ошибки.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-158">The **reason** field is a human-readable description of the error.</span></span><br/><br/> <span data-ttu-id="7c4ce-159">В поле **код ошибки** — целое число и **Ошибка\_тип** поле является строковое представление целого числа, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="7c4ce-159">The **errorId** field is an integer, and the **error\_type** field is the string representation of that integer, as follows:</span></span><ul><li><span data-ttu-id="7c4ce-160">2000000: недопустимый\_подписи</span><span class="sxs-lookup"><span data-stu-id="7c4ce-160">2000000: invalid\_signature</span></span></li><li><span data-ttu-id="7c4ce-161">2000001: недопустимый\_маркеров</span><span class="sxs-lookup"><span data-stu-id="7c4ce-161">2000001: invalid\_token</span></span></li><li>  <span data-ttu-id="7c4ce-162">2000002: маркеров\_срока действия</span><span class="sxs-lookup"><span data-stu-id="7c4ce-162">2000002: token\_expired</span></span></li><li><span data-ttu-id="7c4ce-163">2000003: недопустимый\_ресурсов</span><span class="sxs-lookup"><span data-stu-id="7c4ce-163">2000003: invalid\_resource</span></span></li><li><span data-ttu-id="7c4ce-164">2000004: недопустимый\_клиента</span><span class="sxs-lookup"><span data-stu-id="7c4ce-164">2000004: invalid\_tenant</span></span>  </li><li><span data-ttu-id="7c4ce-165">2000005: недопустимый\_пользователя</span><span class="sxs-lookup"><span data-stu-id="7c4ce-165">2000005: invalid\_user</span></span></li><li><span data-ttu-id="7c4ce-166">2000006: недопустимый\_клиента</span><span class="sxs-lookup"><span data-stu-id="7c4ce-166">2000006: invalid\_client</span></span></li><li><span data-ttu-id="7c4ce-167">2000007: внутренний\_об ошибках</span><span class="sxs-lookup"><span data-stu-id="7c4ce-167">2000007: internal\_error</span></span></li><li><span data-ttu-id="7c4ce-168">2000008: недопустимый\_предоставить</span><span class="sxs-lookup"><span data-stu-id="7c4ce-168">2000008: invalid\_grant</span></span></li></ul> |
   
## <a name="report-ews-latency-to-microsoft"></a><span data-ttu-id="7c4ce-169">Отчет о задержке веб-служб Exchange в корпорацию Майкрософт</span><span class="sxs-lookup"><span data-stu-id="7c4ce-169">Report EWS latency to Microsoft</span></span>
<span data-ttu-id="7c4ce-170"><a name="bk_ReportLatency"> </a></span><span class="sxs-lookup"><span data-stu-id="7c4ce-170"></span></span>

<span data-ttu-id="7c4ce-171">Если приложение использует управляемый API EWS или веб-служб Exchange для подключения к Exchange Online, можно сообщить о задержке запросов веб-служб Exchange в непосредственно в корпорацию Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-171">If your application uses the EWS Managed API or EWS to connect to Exchange Online, you can report latency in EWS requests directly to Microsoft.</span></span> <span data-ttu-id="7c4ce-172">Сведения передаются через заголовка X-ClientStatistics запроса.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-172">The information is passed via the X-ClientStatistics request header.</span></span> <span data-ttu-id="7c4ce-173">При использовании управляемого интерфейса API веб-служб Exchange все, что вам потребуется выполнить присвоено свойству [ExchangeService.SendClientLatencies](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) **значение true**.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-173">If you are using the EWS Managed API, all you have to do is set the [ExchangeService.SendClientLatencies](http://msdn.microsoft.com/en-us/library/microsoft.exchange.webservices.data.exchangeservicebase.sendclientlatencies%28v=exchg.80%29.aspx) property to **true**.</span></span> <span data-ttu-id="7c4ce-174">Если вы используете веб-служб Exchange, необходимо оценить с момента отправки запроса и ответа, а затем добавить заголовок X-ClientStatistics следующего запроса веб-служб Exchange, которые приложение отправляет в следующем формате.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-174">If you are using EWS, you'll need to measure the time between issuing a request and receiving a response, then add the X-ClientStatistics header to the next EWS request your application sends, using the following format.</span></span>
  
`X-ClientStatistics: MessageId=<value of request-id header>,ResponseTime=<time in milliseconds>,SoapAction=<EWS operation>`
  
<span data-ttu-id="7c4ce-175">Мы Ведение отчетов для этих задержек и использовать их для постоянно повышать службы веб-служб Exchange в Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-175">We maintain reports for these latencies and use them to continuously improve EWS services in Exchange Online.</span></span>
  
## <a name="next-steps"></a><span data-ttu-id="7c4ce-176">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="7c4ce-176">Next steps</span></span>
<span data-ttu-id="7c4ce-177"><a name="bk_ReportLatency"> </a></span><span class="sxs-lookup"><span data-stu-id="7c4ce-177"></span></span>

<span data-ttu-id="7c4ce-178">После добавления инструментария клиентского приложения лучше подготовиться к Если возникновения непредвиденных обстоятельств.</span><span class="sxs-lookup"><span data-stu-id="7c4ce-178">After you've added client instrumentation to your application, you're better prepared if something goes wrong.</span></span> <span data-ttu-id="7c4ce-179">В этом случае можно использовать данные инструментирования для [устранения неполадок приложения](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md).</span><span class="sxs-lookup"><span data-stu-id="7c4ce-179">If that happens, you can use your instrumentation data to [troubleshoot your application](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="7c4ce-180">См. также</span><span class="sxs-lookup"><span data-stu-id="7c4ce-180">See also</span></span>

- [<span data-ttu-id="7c4ce-181">Общие сведения о разработке клиента EWS для Exchange</span><span class="sxs-lookup"><span data-stu-id="7c4ce-181">EWS client design overview for Exchange</span></span>](ews-client-design-overview-for-exchange.md)
- [<span data-ttu-id="7c4ce-182">Трассировка запросы и ответы для устранения неполадок в приложениях управляемый API EWS</span><span class="sxs-lookup"><span data-stu-id="7c4ce-182">Trace requests and responses to troubleshoot EWS Managed API applications</span></span>](how-to-trace-requests-responses-to-troubleshoot-ews-managed-api-applications.md)
- [<span data-ttu-id="7c4ce-183">Инструменты и ресурсы для устранения неполадок приложений EWS для Exchange</span><span class="sxs-lookup"><span data-stu-id="7c4ce-183">Tools and resources for troubleshooting EWS applications for Exchange</span></span>](tools-and-resources-for-troubleshooting-ews-applications-for-exchange.md)
    

