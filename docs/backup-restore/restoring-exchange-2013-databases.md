---
title: Восстановление баз данных Exchange 2013
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
ms.prod: office-online-server
localization_priority: Normal
ms.assetid: e0804bb1-fd66-448a-b2cb-9ae2726ae888
description: Узнайте о различных способах восстановления баз данных Exchange 2013.
ms.openlocfilehash: 9fe417bda5dc728af619da02d62ada6e920f731d
ms.sourcegitcommit: 88ec988f2bb67c1866d06b361615f3674a24e795
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2020
ms.locfileid: "44528675"
---
# <a name="restoring-exchange-2013-databases"></a>Восстановление баз данных Exchange 2013

Узнайте о различных способах восстановления баз данных Exchange 2013. 
  
**Применимо к:** Exchange Server 2013 
  
Модуль записи Exchange, включенный в Exchange Server 2013, обеспечивает некоторую гибкость при восстановлении баз данных Exchange. С помощью модуля записи Exchange в Exchange 2013 вы можете восстановить резервные копии теневых копий в следующих папках:
  
- Исходная база данных независимо от того, изменилась ли конфигурация пути к базе данных или файлу журнала транзакций.
    
- База данных восстановления.
    
- Любая рабочая база данных независимо от того, соответствует ли отображаемое имя базы данных имени в резервном наборе данных VSS.
    
Когда приложение восстановления восстанавливает сведения в исходной базе данных, необходимо восстановить файлы журнала в каталоге, указанном в доменных службах Active Directory (AD DS) для этой базы данных. Если приложение восстанавливает базу данных в другом расположении, файлы журнала необходимо восстановить в папку с именем **_restoredLogs** , расположенную в каталоге файлов журнала базы данных. 
  
При восстановлении на сервер или базу данных, которые отличаются от исходной базы данных, ваше приложение восстановления должно обеспечить соответствие путей к каталогам базы данных, предоставленным в службе каталогов Active Directory, для службы каталогов Active Directory. Вы можете использовать командлет [Get – MailboxDatabase](https://technet.microsoft.com/library/bb124924%28v=exchg.150%29.aspx)Exchange Management Shell для получения сведений о существующих базах данных. Дополнительные сведения о командной консоли Exchange можно найти в статье [Exchange Server PowerShell (Командная консоль Exchange)](https://docs.microsoft.com/powershell/exchange/exchange-server/exchange-management-shell?view=exchange-ps). 
  
На следующем рисунке показана последовательность событий в типичном восстановлении базы данных Exchange, управляемой службой теневого копирования томов (VSS).
  
**Рис. 1. Последовательность событий для восстановления баз данных**

![Диаграмма, показывающая последовательность событий для процесса восстановления. Последовательность начинается с запуска хранилищ Exchange, после чего службой записи Exchange, VSS и клиентским приложением выполняется ряд действий.](media/VSS_StoreWriterRestore.gif)
  
## <a name="restoring-exchange-databases-to-the-original-location"></a>Восстановление баз данных Exchange в исходном расположении
<a name="bk_OriginalLocation"> </a>

Средство записи Exchange позволяет приложениям восстанавливать базы данных и файлы журналов транзакций в их исходных расположениях на сервере Exchange. По умолчанию средство записи Exchange воспроизводит файлы журнала транзакций после подтверждения того, что восстановление завершено во время операции [онпостресторе](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx) . Для предотвращения преобразования файлов журнала приложение восстановления должно использовать метод VSS [сетаддитионалресторес](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx) . Файлы журналов можно воссоздать позже, когда администратор Exchange или ваше приложение подключит восстановленную базу данных. 
  
При восстановлении баз данных в исходных объектах базы данных (например, если целевые идентификаторы GUID в базе данных соответствуют именам в резервном наборе данных), но в разные пути к файлам, приложение должно определять текущие пути файлов и восстанавливать файлы резервных копий в соответствующие пути файлов, указанные в свойствах базы данных. Запросивший должен вызвать метод [аддневтаржет](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) для связи с устройством записи Exchange, в котором файлы восстанавливаются, прежде чем средство записи сможет продолжить работу с оставшейся частью процесса восстановления. Если **аддневтаржет** не вызывается, средство записи Exchange Writer предполагает восстановление путей к файлам, указанным в резервной копии документа метаданных. 
  
Как правило, приложению не требуется указывать новый путь для резервных копий, выполняемых из копии группы обеспечения доступности баз данных (DAG). Администраторы Exchange обычно не изменяют пути к файлам базы данных или журнала. Однако в конфигурации группы обеспечения доступности баз данных для приложения резервного копирования может потребоваться указать активные базы данных и пути журналов, так как пути копий DAG всегда отличаются от путей.
  
Обратите внимание, что Exchange 2013 не поддерживает восстановление неактивных копий баз данных DAG. Копии группы обеспечения доступности баз данных можно восстановить из архивных данных только при восстановлении активной копии базы данных. Использование разных наборов данных резервных копий или попытки восстановления подмножества копий базы данных может привести к тому, что база данных станет недоступна. Приложениям резервного копирования не требуется вызывать функцию [сетрестореоптионс](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) в этом случае, так как резервные копии восстанавливаются в исходные объекты базы данных, из которых они были созданы. Однако если приложение резервного копирования вызывает **сетрестореоптионс** , а документ метаданных XML содержит правильные параметры, результат не является ошибкой. 
  
## <a name="restoring-exchange-databases-to-a-recovery-database"></a>Восстановление баз данных Exchange в базе данных восстановления
<a name="bk_RecoveryDatabase"> </a>

Средство записи Exchange Writer позволяет восстанавливать данные непосредственно в базу данных восстановления. Подключение восстановленных данных в качестве базы данных восстановления позволяет администратору Exchange восстановить отдельные почтовые ящики и даже отдельные элементы в почтовом ящике.
  
Если база данных восстановления уже существует, приложение может отключить базу данных, восстановить данные в базу данных восстановления и файлы журналов, а затем подключить базу данных.
  
Каждый сервер Exchange 2013 позволяет подключаться только к одной базе данных восстановления. Сервер может содержать максимально допустимое количество восстановленных баз данных, но только один из них может быть смонтирован в качестве базы данных восстановления. База данных, подключенная в качестве базы данных восстановления, подсчитывается в максимальное число баз данных, которые могут быть подключены за раз. Восстановленная база данных, подключенная в качестве базы данных восстановления сервера, не связана ни с каким исходным почтовым ящиком.
  
Чтобы восстановить базу данных восстановления, приложение должно вызвать метод [сетрестореоптионс](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) и предоставить XML-документ, УКАЗЫВАЮЩий идентификаторы GUID исходной и целевой базы данных. Исходные GUID должны совпадать с набором резервного копирования, а целевые идентификаторы GUID должны совпадать с записями конечных баз данных в AD DS. Приложение резервного копирования также должно вызывать метод [аддневтаржет](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) , чтобы указать путь к каталогу, в который восстанавливаются файлы. Если требуется переименование файлов базы данных, то служба Exchange Writer переименует базу данных во время операции [онпостресторе](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx) . Для Exchange требуется восстановление файлов журнала транзакций во вложенную папку ( **_restoredLogs**) под текущим путем к файлу журнала транзакций. Если файлы журнала восстановлены в другом расположении, то средство записи Exchange будет возвращать ошибку. Так как базы данных, подключенные в качестве базы данных восстановления, не восстанавливаются в исходном расположении, их необходимо перевести в состояние чистого отключения, прежде чем их можно будет подключить. По умолчанию средство записи Exchange будет переносить все восстановленные базы данных в состояние чистого отключения во время процедуры после восстановления. Если приложение резервного копирования вызывает метод [сетаддитионалресторес](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx) , то модуль записи Exchange не восвоспроизводит файлы журнала, а администратор или приложение резервного копирования должны перевести базу данных в состояние чистого отключения перед подключением базы данных. 
  
## <a name="restoring-exchange-databases-to-a-recovery-server"></a>Восстановление баз данных Exchange на сервере восстановления
<a name="bk_RecoveryServer"> </a>

В некоторых случаях может потребоваться восстановить резервный набор данных на другом сервере. Например, может потребоваться восстановление из строя аварийного сервера путем переноса базы данных почтовых ящиков на другой сервер Exchange 2013 в той же организации Exchange или восстановление выделенного сервера за прев рабочей среде для восстановления данных почтовых ящиков и общедоступных папок. 
  
В этих сценариях пути к целевой базе данных, а также идентификаторы GUID объектов отличаются от тех, которые относятся к исходной базе данных. Поэтому приложение должно вызвать метод [сетрестореоптионс](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) с XML-документом, указывающим сведения об исходной и целевой базе данных, и вызвать метод [аддневтаржет](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) для указания путей к каталогам для восстановления файлов резервных копий. Для модуля записи Exchange это восстановление выполняется так же, как и восстановление в базу данных восстановления. Более подробную информацию можно узнать в статье [восстановление баз данных Exchange в базу данных восстановления](restoring-exchange-2013-databases.md#bk_RecoveryDatabase) , приведенную ранее в этой статье. 
  
## <a name="see-also"></a>См. также
<a name="bk_AdditionalResources"> </a>

- [Типы операций резервного копирования для Exchange 2013](types-of-backup-operations-for-exchange-2013.md)
    
- [Создание приложений резервного копирования и восстановления для Exchange 2013](build-backup-and-restore-applications-for-exchange-2013.md)
    
- [Основные понятия резервного копирования и восстановления для Exchange 2013](backup-and-restore-concepts-for-exchange-2013.md)
    
- [Справочник по классу функция cchksgfiles](cchksgfiles-class-reference.md)
    

