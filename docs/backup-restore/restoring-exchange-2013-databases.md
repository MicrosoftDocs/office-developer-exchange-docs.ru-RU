---
title: Восстановление баз данных Exchange 2013
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
ms.prod: office-online-server
localization_priority: Normal
ms.assetid: e0804bb1-fd66-448a-b2cb-9ae2726ae888
description: Найдите сведения о различных способах возможности восстановления баз данных Exchange 2013.
ms.openlocfilehash: d3ca3a884b0ad30f7d7968a9ed435b02aaf205e1
ms.sourcegitcommit: 34041125dc8c5f993b21cebfc4f8b72f0fd2cb6f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19760949"
---
# <a name="restoring-exchange-2013-databases"></a><span data-ttu-id="11662-103">Восстановление баз данных Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="11662-103">Restoring Exchange 2013 databases</span></span>

<span data-ttu-id="11662-104">Найдите сведения о различных способах возможности восстановления баз данных Exchange 2013.</span><span class="sxs-lookup"><span data-stu-id="11662-104">Find information about the different ways that you can restore your Exchange 2013 databases.</span></span> 
  
<span data-ttu-id="11662-105">**Применимо к:** Exchange Server 2013</span><span class="sxs-lookup"><span data-stu-id="11662-105">**Applies to:** Exchange Server 2013</span></span> 
  
<span data-ttu-id="11662-106">Модуль записи Exchange, включенный в Exchange Server 2013 обеспечивает некоторые гибкость в как восстановление баз данных Exchange.</span><span class="sxs-lookup"><span data-stu-id="11662-106">The Exchange writer that is included in Exchange Server 2013 allows for some flexibility in how you restore your Exchange databases.</span></span> <span data-ttu-id="11662-107">С помощью модуля записи Exchange в Exchange 2013, можно восстановить теневых копий по следующим адресам:</span><span class="sxs-lookup"><span data-stu-id="11662-107">By using the Exchange writer in Exchange 2013, you can restore your shadow copy backups to the following locations:</span></span>
  
- <span data-ttu-id="11662-108">Исходной базы данных, независимо от того, были ли изменены конфигурацию путь файла базы данных или транзакций журнала.</span><span class="sxs-lookup"><span data-stu-id="11662-108">The original database, regardless of whether the database or transaction log file path configuration has been modified.</span></span>
    
- <span data-ttu-id="11662-109">Базы данных восстановления.</span><span class="sxs-lookup"><span data-stu-id="11662-109">A recovery database.</span></span>
    
- <span data-ttu-id="11662-110">Любой производственной базы данных, независимо от того, является ли отображаемое имя базы данных совпадает с именем в архив служба теневого копирования ТОМОВ.</span><span class="sxs-lookup"><span data-stu-id="11662-110">Any production database, regardless of whether the database display name matches the name in a VSS backup set.</span></span>
    
<span data-ttu-id="11662-111">Когда приложение восстановления восстанавливает сведения с исходной базой данных, файлов журнала необходимо восстанавливать каталог пути, указанному в доменных службах Active Directory (AD DS) для этой базы данных.</span><span class="sxs-lookup"><span data-stu-id="11662-111">When your restore application restores information to the original database, the log files must be restored to the directory path specified in Active Directory Domain Services (AD DS) for that database.</span></span> <span data-ttu-id="11662-112">Если приложение, восстанавливает базу данных в другом месте, файлов журнала, необходимо восстанавливать в папку с именем **_restoredLogs** , расположенное в папке файла журнала базы данных.</span><span class="sxs-lookup"><span data-stu-id="11662-112">If your application restores a database to a different location, the log files must be restored to a folder named **_restoredLogs** that is located inside the database log file directory.</span></span> 
  
<span data-ttu-id="11662-113">При восстановлении на сервер или базу данных, отличного от исходной базы данных, восстановление приложения необходимо убедитесь, что база данных каталога для VSS соответствие путей в Доменных службах Active Directory.</span><span class="sxs-lookup"><span data-stu-id="11662-113">When restoring to a server or database that is different than the original database, your restore application must make sure that the database directory paths provided to VSS match those in AD DS.</span></span> <span data-ttu-id="11662-114">[get-MailboxDatabase](http://technet.microsoft.com/en-us/library/bb124924%28v=exchg.150%29.aspx)используется командная консоль Exchange можно использовать для получения сведений о существующих баз данных.</span><span class="sxs-lookup"><span data-stu-id="11662-114">You can use the [get-MailboxDatabase](http://technet.microsoft.com/en-us/library/bb124924%28v=exchg.150%29.aspx)Exchange Management Shell cmdlet to get information about existing databases.</span></span> <span data-ttu-id="11662-115">Дополнительные сведения о командной консоли Exchange можно [Exchange Server PowerShell (Командная консоль Exchange)](https://docs.microsoft.com/en-us/powershell/exchange/exchange-server/exchange-management-shell?view=exchange-ps).</span><span class="sxs-lookup"><span data-stu-id="11662-115">For more information about the Exchange Management Shell, see [Exchange Server PowerShell (Exchange Management Shell)](https://docs.microsoft.com/en-us/powershell/exchange/exchange-server/exchange-management-shell?view=exchange-ps).</span></span> 
  
<span data-ttu-id="11662-116">На следующем рисунке показана последовательность событий в типичного восстановить базы данных Exchange, который является управляемым путем службы теневого копирования томов (VSS).</span><span class="sxs-lookup"><span data-stu-id="11662-116">The following figure shows the sequence of events in a typical restore of an Exchange database that is managed by the Volume Shadow Copy Service (VSS).</span></span>
  
<span data-ttu-id="11662-117">**На рисунке 1. Последовательность событий при восстановлении баз данных**</span><span class="sxs-lookup"><span data-stu-id="11662-117">**Figure 1. Sequence of events for restoring databases**</span></span>

![Диаграмма, показывающая последовательность событий для процесса восстановления. Последовательность начинается с запуска хранилищ Exchange, после чего службой записи Exchange, VSS и клиентским приложением выполняется ряд действий.](media/VSS_StoreWriterRestore.gif)
  
## <a name="restoring-exchange-databases-to-the-original-location"></a><span data-ttu-id="11662-120">Восстановление баз данных Exchange в исходное расположение</span><span class="sxs-lookup"><span data-stu-id="11662-120">Restoring Exchange databases to the original location</span></span>
<span data-ttu-id="11662-121"><a name="bk_OriginalLocation"> </a></span><span class="sxs-lookup"><span data-stu-id="11662-121"></span></span>

<span data-ttu-id="11662-122">Модуль записи Exchange позволяет приложениям для восстановления баз данных и файлы журнала транзакций в исходные папки на сервере Exchange.</span><span class="sxs-lookup"><span data-stu-id="11662-122">The Exchange writer enables applications to restore databases and transaction log files to their original locations on the Exchange server.</span></span> <span data-ttu-id="11662-123">По умолчанию модуля записи Exchange преобразует файлы журналов транзакций после инициатор подтверждает, что восстановление закончено во время операции [OnPostRestore](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381566%28v=vs.85%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="11662-123">By default, the Exchange writer replays the transaction log files after the requester confirms that the restore is complete during the [OnPostRestore](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381566%28v=vs.85%29.aspx) operation.</span></span> <span data-ttu-id="11662-124">Восстановление приложения необходимо использовать метод служба теневого копирования ТОМОВ [SetAdditionalRestores](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382829%28v=vs.85%29.aspx) для предотвращения воспроизведения файлов журнала.</span><span class="sxs-lookup"><span data-stu-id="11662-124">The restore application must use the VSS [SetAdditionalRestores](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382829%28v=vs.85%29.aspx) method to prevent having the log files replayed.</span></span> <span data-ttu-id="11662-125">Файлы журнала, поможет в дальнейшем, когда администратор Exchange или приложение снова подключает восстановленной базы данных.</span><span class="sxs-lookup"><span data-stu-id="11662-125">The log files can be replayed at a later time when the Exchange administrator or your application remounts the restored database.</span></span> 
  
<span data-ttu-id="11662-126">При восстановлении баз данных их исходной базы данных объектов (таким образом, что идентификаторы GUID целевой базы данных соответствуют архива), но для разных путей приложения необходимо определить текущего пути к файлам и восстановления файлов резервных копий для соответствующий файл пути, указанных в свойствах базы данных.</span><span class="sxs-lookup"><span data-stu-id="11662-126">When restoring databases back to their original database objects (such that the target GUIDs in the database match those in the backup set) but to different file paths, the application must determine the current file paths and restore the backup files to the corresponding file paths specified in the database properties.</span></span> <span data-ttu-id="11662-127">Источник запроса необходимо вызвать метод [AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx) сообщать модуля записи Exchange расположение, где будут восстановлены файлы перед модуля записи можно продолжить процесс восстановления.</span><span class="sxs-lookup"><span data-stu-id="11662-127">The requester must call the [AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to communicate to the Exchange writer the location where the files are restored before the writer can continue with the rest of the restore process.</span></span> <span data-ttu-id="11662-128">Если **AddNewTarget** не вызывается, Exchange предполагается, что резервные копии будут восстановлены в пути к файлам, указанных в документ метаданных резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="11662-128">If **AddNewTarget** is not called, the Exchange writer assumes that the backups are restored to the file paths specified in the backup metadata document.</span></span> 
  
<span data-ttu-id="11662-129">Как правило приложения не нужно указать новый путь для резервного копирования, выполняемыми из копии группы обеспечения доступности баз данных (DAG).</span><span class="sxs-lookup"><span data-stu-id="11662-129">Typically, your application does not have to specify a new path for backups that are performed from a Database Availability Group (DAG) copy.</span></span> <span data-ttu-id="11662-130">Администраторы Exchange обычно не изменяйте пути к файлам базы данных и журнала.</span><span class="sxs-lookup"><span data-stu-id="11662-130">Exchange administrators do not usually change database or log file paths.</span></span> <span data-ttu-id="11662-131">В конфигурации группы доступности базы данных тем не менее, приложение резервного копирования может потребоваться задание активной базы данных и журнала пути, поскольку пути для копирования файлов группы доступности базы данных всегда могут отличаться от этих путей.</span><span class="sxs-lookup"><span data-stu-id="11662-131">In a DAG configuration, however, the backup application might have to specify the active database and log paths, because DAG copy paths are always different from those paths.</span></span>
  
<span data-ttu-id="11662-132">Обратите внимание на то, что Exchange 2013 не поддерживает восстановление неактивных копий базы данных для обеспечения доступности баз данных.</span><span class="sxs-lookup"><span data-stu-id="11662-132">Note that Exchange 2013 does not support restoring inactive DAG database copies.</span></span> <span data-ttu-id="11662-133">Копий группы доступности базы данных может быть восстановлена из резервной копии данных, только в том случае, если восстанавливается активной копии базы данных.</span><span class="sxs-lookup"><span data-stu-id="11662-133">DAG copies can be restored from backup data only when the active database copy is restored.</span></span> <span data-ttu-id="11662-134">С помощью различных резервных наборов данных или при попытке восстановления подмножество копий базы данных может привести к базе данных стать подключения.</span><span class="sxs-lookup"><span data-stu-id="11662-134">Using different backup data sets or attempting to restore a subset of the database copies can cause the database to become unmountable.</span></span> <span data-ttu-id="11662-135">Приложений резервного копирования нет необходимости в этом случае вызовите функцию [SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx) так, как восстанавливать резервные копии в исходной базы данных объектов, которые они были созданы на основе.</span><span class="sxs-lookup"><span data-stu-id="11662-135">Backup applications do not have to call the [SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx) function in this case, because the backups are restored to the original database objects they were created from.</span></span> <span data-ttu-id="11662-136">Тем не менее если приложение резервного копирования вызывает **SetRestoreOptions** и XML-документ метаданных имеет правильные параметры, результат не ошибка.</span><span class="sxs-lookup"><span data-stu-id="11662-136">However, if the backup application calls **SetRestoreOptions** and the XML metadata document has the correct parameters, the result is not an error.</span></span> 
  
## <a name="restoring-exchange-databases-to-a-recovery-database"></a><span data-ttu-id="11662-137">Восстановление баз данных Exchange для базы данных восстановления</span><span class="sxs-lookup"><span data-stu-id="11662-137">Restoring Exchange databases to a recovery database</span></span>
<span data-ttu-id="11662-138"><a name="bk_RecoveryDatabase"> </a></span><span class="sxs-lookup"><span data-stu-id="11662-138"></span></span>

<span data-ttu-id="11662-139">Записи Exchange позволяет восстанавливать данные непосредственно для базы данных восстановления.</span><span class="sxs-lookup"><span data-stu-id="11662-139">The Exchange writer enables you to restore data directly to a recovery database.</span></span> <span data-ttu-id="11662-140">Монтажные восстановленные данные в виде базы данных восстановления позволяет администратору Exchange для восстановления отдельных почтовых ящиков и даже отдельных элементов в почтовом ящике.</span><span class="sxs-lookup"><span data-stu-id="11662-140">Mounting the recovered data as a recovery database allows the Exchange administrator to restore individual mailboxes, and even individual items in a mailbox.</span></span>
  
<span data-ttu-id="11662-141">Если базы данных восстановления уже существует, приложение может отсоединить базу данных, восстановление данных на восстановление базы данных и файлов журналов и затем подключите базу данных.</span><span class="sxs-lookup"><span data-stu-id="11662-141">If a recovery database already exists, your application can dismount the database, restore the data onto the recovery database and log files, and then remount the database.</span></span>
  
<span data-ttu-id="11662-142">Каждый сервер Exchange 2013 обеспечивает только одна база данных восстановления подключить за раз.</span><span class="sxs-lookup"><span data-stu-id="11662-142">Each Exchange 2013 server allows for only one recovery database to be mounted at a time.</span></span> <span data-ttu-id="11662-143">Сервер может содержать столько восстановленные базы данных позволяет место на диске, но только один может быть установлена как базы данных восстановления.</span><span class="sxs-lookup"><span data-stu-id="11662-143">The server can contain as many recovered databases as disk space allows, but only one can be mounted as the recovery database.</span></span> <span data-ttu-id="11662-144">Базы данных, установленных в качестве базы данных восстановления учитывается в поле Максимальное число баз данных, которые можно подключить за раз.</span><span class="sxs-lookup"><span data-stu-id="11662-144">The database mounted as the recovery database is counted in the maximum number of databases that can be mounted at a time.</span></span> <span data-ttu-id="11662-145">Подготовить восстановленную базу данных, поскольку базы данных восстановления сервера не связан с исходным почтовым ящиком никаких уведомлений.</span><span class="sxs-lookup"><span data-stu-id="11662-145">A recovered database mounted as a server's recovery database is not associated with the original mailbox in any way.</span></span>
  
<span data-ttu-id="11662-146">Для восстановления базы данных восстановления, приложения необходимо вызвать метод [SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx) и предоставляют XML-документа, которое указывает, источник и предназначенных для идентификаторов GUID базы данных.</span><span class="sxs-lookup"><span data-stu-id="11662-146">To recover to a recovery database, your application must call the [SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx) method and provide an XML document that indicates the source and target database GUIDs.</span></span> <span data-ttu-id="11662-147">Источник идентификаторы GUID должны совпадать с из резервного набора данных и конечного идентификаторы GUID должны совпадать с записями целевой базы данных в Доменных службах Active Directory.</span><span class="sxs-lookup"><span data-stu-id="11662-147">The source GUIDs must match those from the backup set, and the target GUIDs must match the destination database entries in AD DS.</span></span> <span data-ttu-id="11662-148">Приложение резервного копирования также необходимо вызвать метод [AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx) , чтобы указать путь к каталогу, где эти файлы будут восстановлены.</span><span class="sxs-lookup"><span data-stu-id="11662-148">The backup application must also call the [AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to specify the directory path where the files are restored to.</span></span> <span data-ttu-id="11662-149">Если файлы базы данных необходимо переименовать, модуля записи Exchange будет переименовать базы данных во время операции [OnPostRestore](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381566%28v=vs.85%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="11662-149">If the database files need to be renamed, the Exchange writer will rename the database during the [OnPostRestore](http://msdn.microsoft.com/en-us/library/windows/desktop/aa381566%28v=vs.85%29.aspx) operation.</span></span> <span data-ttu-id="11662-150">Файлы журнала транзакций для восстановления в папке ( **_restoredLogs**) требует Exchange в текущий файл журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="11662-150">Exchange requires the transaction log files to be restored to a subfolder ( **_restoredLogs**) under the current transaction log file path.</span></span> <span data-ttu-id="11662-151">Если файлы журналов будут восстановлены в другое расположение, модуля записи Exchange возвращает ошибку.</span><span class="sxs-lookup"><span data-stu-id="11662-151">If the log files are restored to any other location, the Exchange writer will return an error.</span></span> <span data-ttu-id="11662-152">Так как базы данных установленных в качестве базы данных восстановления не будут восстановлены в исходное расположение, они должны быть предъявлены в состояние чистого отключения, прежде чем их можно подключить.</span><span class="sxs-lookup"><span data-stu-id="11662-152">Because databases being mounted as the recovery database are not restored to their original location, they need to be brought into clean-shutdown state before they can be mounted.</span></span> <span data-ttu-id="11662-153">По умолчанию модуля записи Exchange будет приведения восстановленных баз данных в состояние чистого отключения во время после восстановления.</span><span class="sxs-lookup"><span data-stu-id="11662-153">By default, the Exchange writer will bring all the restored databases into a clean-shutdown state during post-restore.</span></span> <span data-ttu-id="11662-154">Если ваше приложение резервного копирования вызывает метод [SetAdditionalRestores](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382829%28v=vs.85%29.aspx) , модуля записи Exchange не будет воспроизведение файлов журнала и администратор или приложение резервного копирования необходимо перевести базу данных в состояние чистого отключения перед монтажные База данных.</span><span class="sxs-lookup"><span data-stu-id="11662-154">If your backup application calls the [SetAdditionalRestores](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382829%28v=vs.85%29.aspx) method, the Exchange writer will not replay the log files, and either the administrator or your backup application needs to bring the database into a clean-shutdown state prior to mounting the database.</span></span> 
  
## <a name="restoring-exchange-databases-to-a-recovery-server"></a><span data-ttu-id="11662-155">Восстановление баз данных Exchange на сервере восстановления</span><span class="sxs-lookup"><span data-stu-id="11662-155">Restoring Exchange databases to a recovery server</span></span>
<span data-ttu-id="11662-156"><a name="bk_RecoveryServer"> </a></span><span class="sxs-lookup"><span data-stu-id="11662-156"></span></span>

<span data-ttu-id="11662-157">В некоторых случаях может потребоваться восстановить резервную копию в другой сервер; Например, может потребоваться восстановление после сбоя аварийное сервера после переноса базы данных почтовых ящиков на другой сервер Exchange 2013 в той же организации Exchange или восстановление выделенного сервера за пределами в рабочей среде, чтобы восстановить почтовый ящик и данные общедоступных папок.</span><span class="sxs-lookup"><span data-stu-id="11662-157">In some scenarios, you might need to recover a backup set to another server; For example, you might need to recover from a catastrophic server failure by porting the mailbox database to another Exchange 2013 server in the same Exchange organization, or restore to a dedicated server outside the production environment to recover mailbox and public folder data.</span></span> 
  
<span data-ttu-id="11662-158">В следующих сценариях пути к файлам для целевой базы данных, а также его GUID объекта, отличаются от тех, для исходной базы данных.</span><span class="sxs-lookup"><span data-stu-id="11662-158">In these scenarios, the file paths for the target database as well as its object GUIDs are different than those for the original database.</span></span> <span data-ttu-id="11662-159">Таким образом ваше приложение должно вызвать метод [SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx) с XML-документа, которое указывает, источник и сведения о целевой базы данных и вызов метода [AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx) для указания пути для файлов резервной копии для восстановления .</span><span class="sxs-lookup"><span data-stu-id="11662-159">Therefore, your application has to call the [SetRestoreOptions](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382856%28v=vs.85%29.aspx) method with an XML document that indicates the source and target database information, and call the [AddNewTarget](http://msdn.microsoft.com/en-us/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to specify the directory paths to restore the backup files to.</span></span> <span data-ttu-id="11662-160">Для модуля записи Exchange в этом восстановления совпадает с восстановлением базы данных восстановления.</span><span class="sxs-lookup"><span data-stu-id="11662-160">For the Exchange writer, this restore is the same as restoring to a recovery database.</span></span> <span data-ttu-id="11662-161">Для получения дополнительных сведений см [Exchange восстановление баз данных для базы данных восстановления](restoring-exchange-2013-databases.md#bk_RecoveryDatabase) ранее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="11662-161">For more information, see [Restoring Exchange databases to a recovery database](restoring-exchange-2013-databases.md#bk_RecoveryDatabase) earlier in this article.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="11662-162">См. также</span><span class="sxs-lookup"><span data-stu-id="11662-162">See also</span></span>
<span data-ttu-id="11662-163"><a name="bk_AdditionalResources"> </a></span><span class="sxs-lookup"><span data-stu-id="11662-163"></span></span>

- [<span data-ttu-id="11662-164">Типы операций резервного копирования для Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="11662-164">Types of backup operations for Exchange 2013</span></span>](types-of-backup-operations-for-exchange-2013.md)
    
- [<span data-ttu-id="11662-165">Построение резервное копирование и восстановление приложений для Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="11662-165">Build backup and restore applications for Exchange 2013</span></span>](build-backup-and-restore-applications-for-exchange-2013.md)
    
- [<span data-ttu-id="11662-166">Основные понятия резервного копирования и восстановления для Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="11662-166">Backup and restore concepts for Exchange 2013</span></span>](backup-and-restore-concepts-for-exchange-2013.md)
    
- [<span data-ttu-id="11662-167">Справочник по CChkSGFiles классов</span><span class="sxs-lookup"><span data-stu-id="11662-167">CChkSGFiles class reference</span></span>](cchksgfiles-class-reference.md)
    

