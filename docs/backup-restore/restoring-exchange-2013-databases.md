---
title: Восстановление баз данных Exchange 2013
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
ms.prod: office-online-server
localization_priority: Normal
ms.assetid: e0804bb1-fd66-448a-b2cb-9ae2726ae888
description: Узнайте о различных способах восстановления баз данных Exchange 2013.
ms.openlocfilehash: 9fe417bda5dc728af619da02d62ada6e920f731d
ms.sourcegitcommit: 88ec988f2bb67c1866d06b361615f3674a24e795
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2020
ms.locfileid: "44528675"
---
# <a name="restoring-exchange-2013-databases"></a><span data-ttu-id="778c0-103">Восстановление баз данных Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="778c0-103">Restoring Exchange 2013 databases</span></span>

<span data-ttu-id="778c0-104">Узнайте о различных способах восстановления баз данных Exchange 2013.</span><span class="sxs-lookup"><span data-stu-id="778c0-104">Find information about the different ways that you can restore your Exchange 2013 databases.</span></span> 
  
<span data-ttu-id="778c0-105">**Применимо к:** Exchange Server 2013</span><span class="sxs-lookup"><span data-stu-id="778c0-105">**Applies to:** Exchange Server 2013</span></span> 
  
<span data-ttu-id="778c0-106">Модуль записи Exchange, включенный в Exchange Server 2013, обеспечивает некоторую гибкость при восстановлении баз данных Exchange.</span><span class="sxs-lookup"><span data-stu-id="778c0-106">The Exchange writer that is included in Exchange Server 2013 allows for some flexibility in how you restore your Exchange databases.</span></span> <span data-ttu-id="778c0-107">С помощью модуля записи Exchange в Exchange 2013 вы можете восстановить резервные копии теневых копий в следующих папках:</span><span class="sxs-lookup"><span data-stu-id="778c0-107">By using the Exchange writer in Exchange 2013, you can restore your shadow copy backups to the following locations:</span></span>
  
- <span data-ttu-id="778c0-108">Исходная база данных независимо от того, изменилась ли конфигурация пути к базе данных или файлу журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="778c0-108">The original database, regardless of whether the database or transaction log file path configuration has been modified.</span></span>
    
- <span data-ttu-id="778c0-109">База данных восстановления.</span><span class="sxs-lookup"><span data-stu-id="778c0-109">A recovery database.</span></span>
    
- <span data-ttu-id="778c0-110">Любая рабочая база данных независимо от того, соответствует ли отображаемое имя базы данных имени в резервном наборе данных VSS.</span><span class="sxs-lookup"><span data-stu-id="778c0-110">Any production database, regardless of whether the database display name matches the name in a VSS backup set.</span></span>
    
<span data-ttu-id="778c0-111">Когда приложение восстановления восстанавливает сведения в исходной базе данных, необходимо восстановить файлы журнала в каталоге, указанном в доменных службах Active Directory (AD DS) для этой базы данных.</span><span class="sxs-lookup"><span data-stu-id="778c0-111">When your restore application restores information to the original database, the log files must be restored to the directory path specified in Active Directory Domain Services (AD DS) for that database.</span></span> <span data-ttu-id="778c0-112">Если приложение восстанавливает базу данных в другом расположении, файлы журнала необходимо восстановить в папку с именем **_restoredLogs** , расположенную в каталоге файлов журнала базы данных.</span><span class="sxs-lookup"><span data-stu-id="778c0-112">If your application restores a database to a different location, the log files must be restored to a folder named **_restoredLogs** that is located inside the database log file directory.</span></span> 
  
<span data-ttu-id="778c0-113">При восстановлении на сервер или базу данных, которые отличаются от исходной базы данных, ваше приложение восстановления должно обеспечить соответствие путей к каталогам базы данных, предоставленным в службе каталогов Active Directory, для службы каталогов Active Directory.</span><span class="sxs-lookup"><span data-stu-id="778c0-113">When restoring to a server or database that is different than the original database, your restore application must make sure that the database directory paths provided to VSS match those in AD DS.</span></span> <span data-ttu-id="778c0-114">Вы можете использовать командлет [Get – MailboxDatabase](https://technet.microsoft.com/library/bb124924%28v=exchg.150%29.aspx)Exchange Management Shell для получения сведений о существующих базах данных.</span><span class="sxs-lookup"><span data-stu-id="778c0-114">You can use the [get-MailboxDatabase](https://technet.microsoft.com/library/bb124924%28v=exchg.150%29.aspx)Exchange Management Shell cmdlet to get information about existing databases.</span></span> <span data-ttu-id="778c0-115">Дополнительные сведения о командной консоли Exchange можно найти в статье [Exchange Server PowerShell (Командная консоль Exchange)](https://docs.microsoft.com/powershell/exchange/exchange-server/exchange-management-shell?view=exchange-ps).</span><span class="sxs-lookup"><span data-stu-id="778c0-115">For more information about the Exchange Management Shell, see [Exchange Server PowerShell (Exchange Management Shell)](https://docs.microsoft.com/powershell/exchange/exchange-server/exchange-management-shell?view=exchange-ps).</span></span> 
  
<span data-ttu-id="778c0-116">На следующем рисунке показана последовательность событий в типичном восстановлении базы данных Exchange, управляемой службой теневого копирования томов (VSS).</span><span class="sxs-lookup"><span data-stu-id="778c0-116">The following figure shows the sequence of events in a typical restore of an Exchange database that is managed by the Volume Shadow Copy Service (VSS).</span></span>
  
<span data-ttu-id="778c0-117">**Рис. 1. Последовательность событий для восстановления баз данных**</span><span class="sxs-lookup"><span data-stu-id="778c0-117">**Figure 1. Sequence of events for restoring databases**</span></span>

![Диаграмма, показывающая последовательность событий для процесса восстановления. Последовательность начинается с запуска хранилищ Exchange, после чего службой записи Exchange, VSS и клиентским приложением выполняется ряд действий.](media/VSS_StoreWriterRestore.gif)
  
## <a name="restoring-exchange-databases-to-the-original-location"></a><span data-ttu-id="778c0-120">Восстановление баз данных Exchange в исходном расположении</span><span class="sxs-lookup"><span data-stu-id="778c0-120">Restoring Exchange databases to the original location</span></span>
<span data-ttu-id="778c0-121"><a name="bk_OriginalLocation"> </a></span><span class="sxs-lookup"><span data-stu-id="778c0-121"><a name="bk_OriginalLocation"> </a></span></span>

<span data-ttu-id="778c0-122">Средство записи Exchange позволяет приложениям восстанавливать базы данных и файлы журналов транзакций в их исходных расположениях на сервере Exchange.</span><span class="sxs-lookup"><span data-stu-id="778c0-122">The Exchange writer enables applications to restore databases and transaction log files to their original locations on the Exchange server.</span></span> <span data-ttu-id="778c0-123">По умолчанию средство записи Exchange воспроизводит файлы журнала транзакций после подтверждения того, что восстановление завершено во время операции [онпостресторе](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="778c0-123">By default, the Exchange writer replays the transaction log files after the requester confirms that the restore is complete during the [OnPostRestore](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx) operation.</span></span> <span data-ttu-id="778c0-124">Для предотвращения преобразования файлов журнала приложение восстановления должно использовать метод VSS [сетаддитионалресторес](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="778c0-124">The restore application must use the VSS [SetAdditionalRestores](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx) method to prevent having the log files replayed.</span></span> <span data-ttu-id="778c0-125">Файлы журналов можно воссоздать позже, когда администратор Exchange или ваше приложение подключит восстановленную базу данных.</span><span class="sxs-lookup"><span data-stu-id="778c0-125">The log files can be replayed at a later time when the Exchange administrator or your application remounts the restored database.</span></span> 
  
<span data-ttu-id="778c0-126">При восстановлении баз данных в исходных объектах базы данных (например, если целевые идентификаторы GUID в базе данных соответствуют именам в резервном наборе данных), но в разные пути к файлам, приложение должно определять текущие пути файлов и восстанавливать файлы резервных копий в соответствующие пути файлов, указанные в свойствах базы данных.</span><span class="sxs-lookup"><span data-stu-id="778c0-126">When restoring databases back to their original database objects (such that the target GUIDs in the database match those in the backup set) but to different file paths, the application must determine the current file paths and restore the backup files to the corresponding file paths specified in the database properties.</span></span> <span data-ttu-id="778c0-127">Запросивший должен вызвать метод [аддневтаржет](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) для связи с устройством записи Exchange, в котором файлы восстанавливаются, прежде чем средство записи сможет продолжить работу с оставшейся частью процесса восстановления.</span><span class="sxs-lookup"><span data-stu-id="778c0-127">The requester must call the [AddNewTarget](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to communicate to the Exchange writer the location where the files are restored before the writer can continue with the rest of the restore process.</span></span> <span data-ttu-id="778c0-128">Если **аддневтаржет** не вызывается, средство записи Exchange Writer предполагает восстановление путей к файлам, указанным в резервной копии документа метаданных.</span><span class="sxs-lookup"><span data-stu-id="778c0-128">If **AddNewTarget** is not called, the Exchange writer assumes that the backups are restored to the file paths specified in the backup metadata document.</span></span> 
  
<span data-ttu-id="778c0-129">Как правило, приложению не требуется указывать новый путь для резервных копий, выполняемых из копии группы обеспечения доступности баз данных (DAG).</span><span class="sxs-lookup"><span data-stu-id="778c0-129">Typically, your application does not have to specify a new path for backups that are performed from a Database Availability Group (DAG) copy.</span></span> <span data-ttu-id="778c0-130">Администраторы Exchange обычно не изменяют пути к файлам базы данных или журнала.</span><span class="sxs-lookup"><span data-stu-id="778c0-130">Exchange administrators do not usually change database or log file paths.</span></span> <span data-ttu-id="778c0-131">Однако в конфигурации группы обеспечения доступности баз данных для приложения резервного копирования может потребоваться указать активные базы данных и пути журналов, так как пути копий DAG всегда отличаются от путей.</span><span class="sxs-lookup"><span data-stu-id="778c0-131">In a DAG configuration, however, the backup application might have to specify the active database and log paths, because DAG copy paths are always different from those paths.</span></span>
  
<span data-ttu-id="778c0-132">Обратите внимание, что Exchange 2013 не поддерживает восстановление неактивных копий баз данных DAG.</span><span class="sxs-lookup"><span data-stu-id="778c0-132">Note that Exchange 2013 does not support restoring inactive DAG database copies.</span></span> <span data-ttu-id="778c0-133">Копии группы обеспечения доступности баз данных можно восстановить из архивных данных только при восстановлении активной копии базы данных.</span><span class="sxs-lookup"><span data-stu-id="778c0-133">DAG copies can be restored from backup data only when the active database copy is restored.</span></span> <span data-ttu-id="778c0-134">Использование разных наборов данных резервных копий или попытки восстановления подмножества копий базы данных может привести к тому, что база данных станет недоступна.</span><span class="sxs-lookup"><span data-stu-id="778c0-134">Using different backup data sets or attempting to restore a subset of the database copies can cause the database to become unmountable.</span></span> <span data-ttu-id="778c0-135">Приложениям резервного копирования не требуется вызывать функцию [сетрестореоптионс](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) в этом случае, так как резервные копии восстанавливаются в исходные объекты базы данных, из которых они были созданы.</span><span class="sxs-lookup"><span data-stu-id="778c0-135">Backup applications do not have to call the [SetRestoreOptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) function in this case, because the backups are restored to the original database objects they were created from.</span></span> <span data-ttu-id="778c0-136">Однако если приложение резервного копирования вызывает **сетрестореоптионс** , а документ метаданных XML содержит правильные параметры, результат не является ошибкой.</span><span class="sxs-lookup"><span data-stu-id="778c0-136">However, if the backup application calls **SetRestoreOptions** and the XML metadata document has the correct parameters, the result is not an error.</span></span> 
  
## <a name="restoring-exchange-databases-to-a-recovery-database"></a><span data-ttu-id="778c0-137">Восстановление баз данных Exchange в базе данных восстановления</span><span class="sxs-lookup"><span data-stu-id="778c0-137">Restoring Exchange databases to a recovery database</span></span>
<span data-ttu-id="778c0-138"><a name="bk_RecoveryDatabase"> </a></span><span class="sxs-lookup"><span data-stu-id="778c0-138"><a name="bk_RecoveryDatabase"> </a></span></span>

<span data-ttu-id="778c0-139">Средство записи Exchange Writer позволяет восстанавливать данные непосредственно в базу данных восстановления.</span><span class="sxs-lookup"><span data-stu-id="778c0-139">The Exchange writer enables you to restore data directly to a recovery database.</span></span> <span data-ttu-id="778c0-140">Подключение восстановленных данных в качестве базы данных восстановления позволяет администратору Exchange восстановить отдельные почтовые ящики и даже отдельные элементы в почтовом ящике.</span><span class="sxs-lookup"><span data-stu-id="778c0-140">Mounting the recovered data as a recovery database allows the Exchange administrator to restore individual mailboxes, and even individual items in a mailbox.</span></span>
  
<span data-ttu-id="778c0-141">Если база данных восстановления уже существует, приложение может отключить базу данных, восстановить данные в базу данных восстановления и файлы журналов, а затем подключить базу данных.</span><span class="sxs-lookup"><span data-stu-id="778c0-141">If a recovery database already exists, your application can dismount the database, restore the data onto the recovery database and log files, and then remount the database.</span></span>
  
<span data-ttu-id="778c0-142">Каждый сервер Exchange 2013 позволяет подключаться только к одной базе данных восстановления.</span><span class="sxs-lookup"><span data-stu-id="778c0-142">Each Exchange 2013 server allows for only one recovery database to be mounted at a time.</span></span> <span data-ttu-id="778c0-143">Сервер может содержать максимально допустимое количество восстановленных баз данных, но только один из них может быть смонтирован в качестве базы данных восстановления.</span><span class="sxs-lookup"><span data-stu-id="778c0-143">The server can contain as many recovered databases as disk space allows, but only one can be mounted as the recovery database.</span></span> <span data-ttu-id="778c0-144">База данных, подключенная в качестве базы данных восстановления, подсчитывается в максимальное число баз данных, которые могут быть подключены за раз.</span><span class="sxs-lookup"><span data-stu-id="778c0-144">The database mounted as the recovery database is counted in the maximum number of databases that can be mounted at a time.</span></span> <span data-ttu-id="778c0-145">Восстановленная база данных, подключенная в качестве базы данных восстановления сервера, не связана ни с каким исходным почтовым ящиком.</span><span class="sxs-lookup"><span data-stu-id="778c0-145">A recovered database mounted as a server's recovery database is not associated with the original mailbox in any way.</span></span>
  
<span data-ttu-id="778c0-146">Чтобы восстановить базу данных восстановления, приложение должно вызвать метод [сетрестореоптионс](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) и предоставить XML-документ, УКАЗЫВАЮЩий идентификаторы GUID исходной и целевой базы данных.</span><span class="sxs-lookup"><span data-stu-id="778c0-146">To recover to a recovery database, your application must call the [SetRestoreOptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) method and provide an XML document that indicates the source and target database GUIDs.</span></span> <span data-ttu-id="778c0-147">Исходные GUID должны совпадать с набором резервного копирования, а целевые идентификаторы GUID должны совпадать с записями конечных баз данных в AD DS.</span><span class="sxs-lookup"><span data-stu-id="778c0-147">The source GUIDs must match those from the backup set, and the target GUIDs must match the destination database entries in AD DS.</span></span> <span data-ttu-id="778c0-148">Приложение резервного копирования также должно вызывать метод [аддневтаржет](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) , чтобы указать путь к каталогу, в который восстанавливаются файлы.</span><span class="sxs-lookup"><span data-stu-id="778c0-148">The backup application must also call the [AddNewTarget](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to specify the directory path where the files are restored to.</span></span> <span data-ttu-id="778c0-149">Если требуется переименование файлов базы данных, то служба Exchange Writer переименует базу данных во время операции [онпостресторе](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="778c0-149">If the database files need to be renamed, the Exchange writer will rename the database during the [OnPostRestore](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx) operation.</span></span> <span data-ttu-id="778c0-150">Для Exchange требуется восстановление файлов журнала транзакций во вложенную папку ( **_restoredLogs**) под текущим путем к файлу журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="778c0-150">Exchange requires the transaction log files to be restored to a subfolder ( **_restoredLogs**) under the current transaction log file path.</span></span> <span data-ttu-id="778c0-151">Если файлы журнала восстановлены в другом расположении, то средство записи Exchange будет возвращать ошибку.</span><span class="sxs-lookup"><span data-stu-id="778c0-151">If the log files are restored to any other location, the Exchange writer will return an error.</span></span> <span data-ttu-id="778c0-152">Так как базы данных, подключенные в качестве базы данных восстановления, не восстанавливаются в исходном расположении, их необходимо перевести в состояние чистого отключения, прежде чем их можно будет подключить.</span><span class="sxs-lookup"><span data-stu-id="778c0-152">Because databases being mounted as the recovery database are not restored to their original location, they need to be brought into clean-shutdown state before they can be mounted.</span></span> <span data-ttu-id="778c0-153">По умолчанию средство записи Exchange будет переносить все восстановленные базы данных в состояние чистого отключения во время процедуры после восстановления.</span><span class="sxs-lookup"><span data-stu-id="778c0-153">By default, the Exchange writer will bring all the restored databases into a clean-shutdown state during post-restore.</span></span> <span data-ttu-id="778c0-154">Если приложение резервного копирования вызывает метод [сетаддитионалресторес](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx) , то модуль записи Exchange не восвоспроизводит файлы журнала, а администратор или приложение резервного копирования должны перевести базу данных в состояние чистого отключения перед подключением базы данных.</span><span class="sxs-lookup"><span data-stu-id="778c0-154">If your backup application calls the [SetAdditionalRestores](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx) method, the Exchange writer will not replay the log files, and either the administrator or your backup application needs to bring the database into a clean-shutdown state prior to mounting the database.</span></span> 
  
## <a name="restoring-exchange-databases-to-a-recovery-server"></a><span data-ttu-id="778c0-155">Восстановление баз данных Exchange на сервере восстановления</span><span class="sxs-lookup"><span data-stu-id="778c0-155">Restoring Exchange databases to a recovery server</span></span>
<span data-ttu-id="778c0-156"><a name="bk_RecoveryServer"> </a></span><span class="sxs-lookup"><span data-stu-id="778c0-156"><a name="bk_RecoveryServer"> </a></span></span>

<span data-ttu-id="778c0-157">В некоторых случаях может потребоваться восстановить резервный набор данных на другом сервере. Например, может потребоваться восстановление из строя аварийного сервера путем переноса базы данных почтовых ящиков на другой сервер Exchange 2013 в той же организации Exchange или восстановление выделенного сервера за прев рабочей среде для восстановления данных почтовых ящиков и общедоступных папок.</span><span class="sxs-lookup"><span data-stu-id="778c0-157">In some scenarios, you might need to recover a backup set to another server; For example, you might need to recover from a catastrophic server failure by porting the mailbox database to another Exchange 2013 server in the same Exchange organization, or restore to a dedicated server outside the production environment to recover mailbox and public folder data.</span></span> 
  
<span data-ttu-id="778c0-158">В этих сценариях пути к целевой базе данных, а также идентификаторы GUID объектов отличаются от тех, которые относятся к исходной базе данных.</span><span class="sxs-lookup"><span data-stu-id="778c0-158">In these scenarios, the file paths for the target database as well as its object GUIDs are different than those for the original database.</span></span> <span data-ttu-id="778c0-159">Поэтому приложение должно вызвать метод [сетрестореоптионс](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) с XML-документом, указывающим сведения об исходной и целевой базе данных, и вызвать метод [аддневтаржет](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) для указания путей к каталогам для восстановления файлов резервных копий.</span><span class="sxs-lookup"><span data-stu-id="778c0-159">Therefore, your application has to call the [SetRestoreOptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) method with an XML document that indicates the source and target database information, and call the [AddNewTarget](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) method to specify the directory paths to restore the backup files to.</span></span> <span data-ttu-id="778c0-160">Для модуля записи Exchange это восстановление выполняется так же, как и восстановление в базу данных восстановления.</span><span class="sxs-lookup"><span data-stu-id="778c0-160">For the Exchange writer, this restore is the same as restoring to a recovery database.</span></span> <span data-ttu-id="778c0-161">Более подробную информацию можно узнать в статье [восстановление баз данных Exchange в базу данных восстановления](restoring-exchange-2013-databases.md#bk_RecoveryDatabase) , приведенную ранее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="778c0-161">For more information, see [Restoring Exchange databases to a recovery database](restoring-exchange-2013-databases.md#bk_RecoveryDatabase) earlier in this article.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="778c0-162">См. также</span><span class="sxs-lookup"><span data-stu-id="778c0-162">See also</span></span>
<span data-ttu-id="778c0-163"><a name="bk_AdditionalResources"> </a></span><span class="sxs-lookup"><span data-stu-id="778c0-163"><a name="bk_AdditionalResources"> </a></span></span>

- [<span data-ttu-id="778c0-164">Типы операций резервного копирования для Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="778c0-164">Types of backup operations for Exchange 2013</span></span>](types-of-backup-operations-for-exchange-2013.md)
    
- [<span data-ttu-id="778c0-165">Создание приложений резервного копирования и восстановления для Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="778c0-165">Build backup and restore applications for Exchange 2013</span></span>](build-backup-and-restore-applications-for-exchange-2013.md)
    
- [<span data-ttu-id="778c0-166">Основные понятия резервного копирования и восстановления для Exchange 2013</span><span class="sxs-lookup"><span data-stu-id="778c0-166">Backup and restore concepts for Exchange 2013</span></span>](backup-and-restore-concepts-for-exchange-2013.md)
    
- [<span data-ttu-id="778c0-167">Справочник по классу функция cchksgfiles</span><span class="sxs-lookup"><span data-stu-id="778c0-167">CChkSGFiles class reference</span></span>](cchksgfiles-class-reference.md)
    

